    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>관리 툴 - Plugin Store</title>
        <style>
            :root{
                --bg-primary:#ffffff;
                --bg-secondary:#ffffff;
                --bg-tertiary:#f9fafb;
                --text-primary:#333;
                --text-secondary:#666;
                --border-color:#e5e7eb;
                --card-bg:#ffffff;
                --input-bg:#ffffff;
                --shadow:rgba(0,0,0,0.08);
                --danger:#ef4444;
                --success:#10b981;
            }
            body.dark-mode{
                --bg-primary:#1a1a1a;
                --bg-secondary:#2d2d2d;
                --bg-tertiary:#383838;
                --text-primary:#e5e5e5;
                --text-secondary:#b3b3b3;
                --border-color:#404040;
                --card-bg:#2d2d2d;
                --input-bg:#383838;
                --shadow:rgba(0,0,0,0.3);
            }
            *{margin:0;padding:0;box-sizing:border-box}
            body{font-family:'Segoe UI',sans-serif;background:var(--bg-primary);min-height:100vh;padding:20px;transition:background 0.3s ease}
            .container{max-width:1200px;margin:0 auto}
            header{background:var(--card-bg);padding:30px;border-radius:20px;box-shadow:0 2px 10px var(--shadow);margin-bottom:30px;display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border-color)}
            h1{color:#667eea;font-size:2em}
            .nav-buttons{display:flex;gap:10px}
            .btn{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-size:1em;transition:all 0.3s}
            .btn-primary{background:#667eea;color:white}
            .btn-danger{background:var(--danger);color:white}
            .btn:hover{transform:scale(1.05)}
            .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
            .stat-card{background:var(--card-bg);padding:25px;border-radius:15px;box-shadow:0 2px 10px var(--shadow);border:1px solid var(--border-color)}
            .stat-number{font-size:2.5em;color:#667eea;font-weight:bold}
            .stat-label{color:var(--text-secondary);margin-top:10px}
            .table-container{background:var(--card-bg);padding:25px;border-radius:15px;box-shadow:0 2px 10px var(--shadow);border:1px solid var(--border-color);overflow-x:auto}
            table{width:100%;border-collapse:collapse}
            th,td{padding:15px;text-align:left;border-bottom:1px solid var(--border-color)}
            th{color:var(--text-primary);font-weight:bold;background:var(--bg-tertiary)}
            td{color:var(--text-secondary)}
            .badge{padding:5px 12px;border-radius:15px;font-size:0.85em;font-weight:bold}
            .badge-success{background:#10b981;color:white}
            .theme-toggle{position:fixed;top:20px;right:20px;background:var(--card-bg);border:2px solid var(--border-color);padding:12px 16px;border-radius:50px;cursor:pointer;font-size:1.5em;box-shadow:0 4px 15px var(--shadow);z-index:1000}
            .theme-toggle:hover{transform:scale(1.1)}
            .alert{background:#fee;border:1px solid #fcc;color:#c33;padding:15px;border-radius:10px;margin-bottom:20px}
        </style>
    </head>
    <body>
        <button class="theme-toggle" onclick="toggleTheme()" title="테마 전환">🌓</button>
        <div class="container">
            <header>
                <h1>⚙️ 관리 툴</h1>
                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="window.location.href='index.html'">← 메인으로</button>
                    <button class="btn btn-danger" onclick="logout()">로그아웃</button>
                </div>
            </header>
            
            <div id="accessDenied" class="alert" style="display:none">
                ❌ 접근 거부: 관리자만 접근 가능합니다.
            </div>
            
            <div id="adminContent" style="display:none">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPlugins">0</div>
                        <div class="stat-label">총 플러그인</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalDownloads">0</div>
                        <div class="stat-label">총 다운로드</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">총 사용자</div>
                    </div>
                </div>
                
                <div class="table-container" style="margin-bottom:30px">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                        <h2 style="color:var(--text-primary);margin:0">👥 유저 관리</h2>
                        <button class="btn btn-primary" onclick="showAddUserModal()" style="background:#10b981">+ 유저 추가</button>
                    </div>
                    <div style="max-height:400px;overflow-y:auto">
                        <table>
                            <thead>
                                <tr>
                                    <th>마인크래프트 ID</th>
                                    <th>Discord ID</th>
                                    <th>잔액</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="usersBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 유저 추가 모달 -->
                <div id="addUserModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:center;align-items:center">
                    <div style="background:var(--card-bg);padding:30px;border-radius:15px;max-width:400px;width:90%">
                        <h3 style="margin-bottom:20px;color:var(--text-primary)">👤 유저 추가</h3>
                        <div style="margin-bottom:15px">
                            <label style="display:block;margin-bottom:5px;color:var(--text-primary);font-weight:bold">마인크래프트 ID</label>
                            <input type="text" id="newMcId" style="width:100%;padding:10px;border:2px solid var(--border-color);border-radius:8px;background:var(--input-bg);color:var(--text-primary)" placeholder="예: Player123">
                        </div>
                        <div style="margin-bottom:15px">
                            <label style="display:block;margin-bottom:5px;color:var(--text-secondary);font-weight:bold">Discord ID (선택사항 - 공백으로 둬도 됩니다)</label>
                            <input type="text" id="newDiscordId" style="width:100%;padding:10px;border:2px solid var(--border-color);border-radius:8px;background:var(--input-bg);color:var(--text-primary)" placeholder="선택사항">
                        </div>
                        <div style="background:var(--bg-tertiary);padding:10px;border-radius:8px;margin-bottom:15px;font-size:0.9em;color:var(--text-secondary)">
                            💡 마인크래프트 닉네임만으로 충분합니다.
                        </div>
                        <div style="display:flex;gap:10px">
                            <button class="btn btn-primary" onclick="addNewUser()" style="flex:1">추가</button>
                            <button class="btn btn-danger" onclick="closeAddUserModal()" style="flex:1">취소</button>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <h2 style="margin-bottom:20px;color:var(--text-primary)">플러그인 목록</h2>
                    <table id="pluginsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>이름</th>
                                <th>카테고리</th>
                                <th>타입</th>
                                <th>가격</th>
                                <th>다운로드</th>
                                <th>평점</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="pluginsBody"></tbody>
                    </table>
                </div>
                
                <!-- 가격 편집 모달 -->
                <div id="priceEditModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:center;align-items:center">
                    <div style="background:var(--card-bg);padding:30px;border-radius:15px;max-width:400px;width:90%">
                        <h3 style="margin-bottom:20px;color:var(--text-primary)">💰 가격 설정</h3>
                        <div style="margin-bottom:15px">
                            <label style="display:block;margin-bottom:5px;color:var(--text-primary);font-weight:bold">플러그인 이름</label>
                            <input type="text" id="editPluginName" style="width:100%;padding:10px;border:2px solid var(--border-color);border-radius:8px;background:var(--input-bg);color:var(--text-primary)" readonly>
                        </div>
                        <div style="margin-bottom:15px">
                            <label style="display:block;margin-bottom:5px;color:var(--text-primary);font-weight:bold">가격 (원)</label>
                            <input type="number" id="editPluginPrice" min="0" style="width:100%;padding:10px;border:2px solid var(--border-color);border-radius:8px;background:var(--input-bg);color:var(--text-primary)" placeholder="0">
                        </div>
                        <div style="margin-bottom:15px">
                            <label style="display:block;margin-bottom:5px;color:var(--text-primary);font-weight:bold">타입</label>
                            <select id="editPluginType" style="width:100%;padding:10px;border:2px solid var(--border-color);border-radius:8px;background:var(--input-bg);color:var(--text-primary)">
                                <option value="free">무료</option>
                                <option value="paid">유료</option>
                            </select>
                        </div>
                        <div style="display:flex;gap:10px">
                            <button class="btn btn-primary" onclick="savePriceEdit()" style="flex:1">저장</button>
                            <button class="btn btn-danger" onclick="closePriceEditModal()" style="flex:1">취소</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
        
        <script>
        const firebaseConfig = {
        apiKey: "AIzaSyB_FsD_GqnENdMGeuzH5Q8tICxn_fgu7OQ",
        authDomain: "plugmarketdb.firebaseapp.com",
        databaseURL: "https://plugmarketdb-default-rtdb.firebaseio.com",
        projectId: "plugmarketdb",
        storageBucket: "plugmarketdb.firebasestorage.app",
        messagingSenderId: "142551495005",
        appId: "1:142551495005:web:6b2b02b9ea53b4198138b4",
        measurementId: "G-3YMWZPCFWQ"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const ADMIN_DISCORD_ID = '787223885766328340';
        
        let currentUser = null;
        let plugins = {};
        let users = {};
        
        function checkAdmin(){
            const user = localStorage.getItem('currentUser');
            if(!user) return false;
            currentUser = JSON.parse(user);
            // Discord ID로 관리자 체크
            return currentUser.discordId === ADMIN_DISCORD_ID;
        }
        
        function loadPlugins(){
            const stored = localStorage.getItem('plugins');
            if(stored){
                plugins = JSON.parse(stored);
            }
            return plugins;
        }
        
        function loadUsers(){
            const stored = localStorage.getItem('allUsers');
            if(stored){
                users = JSON.parse(stored);
            }
            renderUsersTable();
        }
        
        function saveUsers(){
            localStorage.setItem('allUsers', JSON.stringify(users));
        }
        
        function renderStats(){
            const pluginCount = Object.keys(plugins).length;
            const totalDownloads = Object.values(plugins).reduce((sum, p) => sum + (p.downloads || 0), 0);
            const userCount = Object.keys(users).length;
            
            document.getElementById('totalPlugins').textContent = pluginCount;
            document.getElementById('totalDownloads').textContent = totalDownloads;
            document.getElementById('totalUsers').textContent = userCount;
        }
        
        function renderUsersTable(){
            const tbody = document.getElementById('usersBody');
            const userList = Object.values(users);
            
            if(userList.length === 0){
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-secondary)">등록된 유저가 없습니다</td></tr>';
                return;
            }
            
            tbody.innerHTML = userList.map(user => `
                <tr>
                    <td><strong>${user.minecraftId || user.actualMcName || '-'}</strong></td>
                    <td>${user.discordId || '-'}</td>
                    <td style="color:#10b981;font-weight:bold">${(user.balance || 0).toLocaleString()}원</td>
                    <td>
                        <button class="btn btn-primary" onclick="addMoneyToUser('${user.minecraftId}', 1000)" style="background:#10b981;font-size:0.9em;padding:8px 15px">+1,000원</button>
                        <button class="btn btn-primary" onclick="addMoneyToUser('${user.minecraftId}', 2000)" style="background:#3b82f6;font-size:0.9em;padding:8px 15px">+2,000원</button>
                        <button class="btn btn-primary" onclick="addMoneyToUser('${user.minecraftId}', 5000)" style="background:#8b5cf6;font-size:0.9em;padding:8px 15px">+5,000원</button>
                    </td>
                </tr>
            `).join('');
        }
        
        function showAddUserModal(){
            document.getElementById('addUserModal').style.display = 'flex';
        }
        
        function closeAddUserModal(){
            document.getElementById('addUserModal').style.display = 'none';
            document.getElementById('newMcId').value = '';
            document.getElementById('newDiscordId').value = '';
        }
        
        async function addNewUser(){
            const mcId = document.getElementById('newMcId').value.trim();
            const discordId = document.getElementById('newDiscordId').value.trim();
            
            if(!mcId){
                alert('마인크래프트 ID를 입력해주세요');
                return;
            }
            
            if(users[mcId]){
                alert('이미 등록된 유저입니다');
                return;
            }
            
            users[mcId] = {
                minecraftId: mcId,
                discordId: discordId || '',
                balance: 0,
                registeredDate: new Date().toISOString()
            };
            
            saveUsers();
            renderUsersTable();
            renderStats();
            
            // Firebase에 저장
            try {
                await database.ref(`users/${mcId}`).set(users[mcId]);
            } catch(e) {
                console.log('ℹ️ Firebase 저장 불가');
            }
            
            closeAddUserModal();
            alert(`✅ ${mcId} 유저 추가 완료!`);
        }
        
        async function addMoneyToUser(minecraftId, amount){
            if(!confirm(`${minecraftId}님에게 ${amount.toLocaleString()}원을 지급하시겠습니까?`)) return;
            
            if(!users[minecraftId]){
                users[minecraftId] = {
                    minecraftId: minecraftId,
                    balance: 0
                };
            }
            
            users[minecraftId].balance = (users[minecraftId].balance || 0) + amount;
            saveUsers();
            renderUsersTable();
            renderStats();
            
            // Firebase에 저장
            try {
                await database.ref(`users/${minecraftId}`).set(users[minecraftId]);
            } catch(e) {
                console.log('ℹ️ Firebase 저장 불가');
            }
            
            alert(`✅ ${minecraftId}님에게 ${amount.toLocaleString()}원 지급 완료!`);
        }
        
        function renderPluginsTable(){
            const tbody = document.getElementById('pluginsBody');
            tbody.innerHTML = Object.values(plugins).map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td><strong>${p.name}</strong></td>
                    <td><span class="badge badge-success">${p.category}</span></td>
                    <td>${p.type === 'free' ? '무료' : '유료'}</td>
                    <td><strong style="color:#f59e0b">${(p.price || 0).toLocaleString()}원</strong></td>
                    <td>${p.downloads || 0}</td>
                    <td>${(p.rating || 0).toFixed(1)}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editPluginPrice('${p.id}')" style="background:#f59e0b;font-size:0.9em;padding:8px 15px">가격 수정</button>
                        <button class="btn btn-primary" onclick="resetDownloads('${p.id}')" style="font-size:0.9em;padding:8px 15px">다운로드 초기화</button>
                    </td>
                </tr>
            `).join('');
        }
        
        let currentEditingPluginId = null;
        
        function editPluginPrice(pluginId){
            currentEditingPluginId = pluginId;
            const plugin = plugins[pluginId];
            
            document.getElementById('editPluginName').value = plugin.name;
            document.getElementById('editPluginPrice').value = plugin.price || 0;
            document.getElementById('editPluginType').value = plugin.type || 'free';
            
            document.getElementById('priceEditModal').style.display = 'flex';
        }
        
        function closePriceEditModal(){
            document.getElementById('priceEditModal').style.display = 'none';
            currentEditingPluginId = null;
        }
        
        async function savePriceEdit(){
            const newPrice = parseInt(document.getElementById('editPluginPrice').value) || 0;
            const newType = document.getElementById('editPluginType').value;
            
            if(newType === 'paid' && newPrice <= 0){
                alert('유료 플러그인은 가격을 0보다 크게 설정해야 합니다.');
                return;
            }
            
            if(!confirm(`가격을 ${newPrice.toLocaleString()}원으로 설정하시겠습니까?`)) return;
            
            plugins[currentEditingPluginId].price = newPrice;
            plugins[currentEditingPluginId].type = newType;
            
            if(newType === 'free'){
                plugins[currentEditingPluginId].price = 0;
            }
            
            localStorage.setItem('plugins', JSON.stringify(plugins));
            
            // Firebase 업데이트
            try {
                await database.ref(`plugins/${currentEditingPluginId}`).update({
                    price: plugins[currentEditingPluginId].price,
                    type: plugins[currentEditingPluginId].type
                });
            } catch(e) {
                console.log('ℹ️ Firebase 업데이트 불가 - localStorage만 사용');
            }
            
            renderStats();
            renderPluginsTable();
            closePriceEditModal();
            alert('가격 설정 완료!');
        }
        
        async function resetDownloads(pluginId){
            if(!confirm(`${plugins[pluginId].name}의 다운로드 횟수를 0으로 초기화하시겠습니까?`)) return;
            
            plugins[pluginId].downloads = 0;
            localStorage.setItem('plugins', JSON.stringify(plugins));
            
            // Firebase 업데이트
            try {
                await database.ref(`plugins/${pluginId}/downloads`).set(0);
            } catch(e) {
                console.log('ℹ️ Firebase 업데이트 불가 - localStorage만 사용');
            }
            
            renderStats();
            renderPluginsTable();
            alert('초기화 완료!');
        }
        
        function logout(){
            if(confirm('로그아웃 하시겠습니까?')){
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }
        
        function toggleTheme(){
            const body = document.body;
            const isDark = body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon();
        }
        
        function updateThemeIcon(){
            const toggle = document.querySelector('.theme-toggle');
            if(document.body.classList.contains('dark-mode')){
                toggle.textContent = '☀️';
            } else {
                toggle.textContent = '🌓';
            }
        }
        
        function loadTheme(){
            const savedTheme = localStorage.getItem('theme');
            if(savedTheme === 'dark'){
                document.body.classList.add('dark-mode');
            }
            updateThemeIcon();
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            
            console.log('관리자 체크 중...');
            const isAdmin = checkAdmin();
            console.log('관리자 여부:', isAdmin);
            
            if(!isAdmin){
                console.log('접근 거부');
                document.getElementById('accessDenied').style.display = 'block';
            } else {
                console.log('관리자 페이지 표시');
                document.getElementById('adminContent').style.display = 'block';
                loadPlugins();
                loadUsers();
                renderStats();
                renderPluginsTable();
            }
        });
        </script>
    </body>
    </html>

