<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ íˆ´ - Plugin Store</title>
    <style>
        :root{
            --bg-primary:#ffffff;
            --bg-secondary:#ffffff;
            --bg-tertiary:#f9fafb;
            --text-primary:#333;
            --text-secondary:#666;
            --border-color:#e5e7eb;
            --card-bg:#ffffff;
            --input-bg:#ffffff;
            --shadow:rgba(0,0,0,0.08);
            --danger:#ef4444;
            --success:#10b981;
        }
        body.dark-mode{
            --bg-primary:#1a1a1a;
            --bg-secondary:#2d2d2d;
            --bg-tertiary:#383838;
            --text-primary:#e5e5e5;
            --text-secondary:#b3b3b3;
            --border-color:#404040;
            --card-bg:#2d2d2d;
            --input-bg:#383838;
            --shadow:rgba(0,0,0,0.3);
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:var(--bg-primary);min-height:100vh;padding:20px;transition:background 0.3s ease}
        .container{max-width:1200px;margin:0 auto}
        header{background:var(--card-bg);padding:30px;border-radius:20px;box-shadow:0 2px 10px var(--shadow);margin-bottom:30px;display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border-color)}
        h1{color:#667eea;font-size:2em}
        .nav-buttons{display:flex;gap:10px}
        .btn{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-size:1em;transition:all 0.3s}
        .btn-primary{background:#667eea;color:white}
        .btn-danger{background:var(--danger);color:white}
        .btn-success{background:var(--success);color:white}
        .btn:hover{transform:scale(1.05)}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
        .stat-card{background:var(--card-bg);padding:25px;border-radius:15px;box-shadow:0 2px 10px var(--shadow);border:1px solid var(--border-color)}
        .stat-number{font-size:2.5em;color:#667eea;font-weight:bold}
        .stat-label{color:var(--text-secondary);margin-top:10px}
        .table-container{background:var(--card-bg);padding:25px;border-radius:15px;box-shadow:0 2px 10px var(--shadow);border:1px solid var(--border-color);overflow-x:auto;margin-bottom:30px}
        table{width:100%;border-collapse:collapse}
        th,td{padding:15px;text-align:left;border-bottom:1px solid var(--border-color)}
        th{color:var(--text-primary);font-weight:bold;background:var(--bg-tertiary)}
        td{color:var(--text-secondary)}
        .badge{padding:5px 12px;border-radius:15px;font-size:0.85em;font-weight:bold}
        .badge-success{background:#10b981;color:white}
        .badge-warning{background:#f59e0b;color:white}
        .theme-toggle{position:fixed;top:20px;right:20px;background:var(--card-bg);border:2px solid var(--border-color);padding:12px 16px;border-radius:50px;cursor:pointer;font-size:1.5em;box-shadow:0 4px 15px var(--shadow);z-index:1000}
        .theme-toggle:hover{transform:scale(1.1)}
        .alert{background:#fee;border:1px solid #fcc;color:#c33;padding:15px;border-radius:10px;margin-bottom:20px}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:center;align-items:center}
        .modal.active{display:flex}
        .modal-content{background:var(--card-bg);padding:30px;border-radius:15px;max-width:500px;width:90%;max-height:85vh;overflow-y:auto}
        .form-group{margin-bottom:15px}
        .form-group label{display:block;margin-bottom:5px;color:var(--text-primary);font-weight:bold}
        .form-group input,.form-group textarea,.form-group select{width:100%;padding:10px;border:2px solid var(--border-color);border-radius:8px;background:var(--input-bg);color:var(--text-primary)}
        .notice-item{background:var(--bg-tertiary);padding:15px;border-radius:10px;margin-bottom:10px;border-left:4px solid #667eea}
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="í…Œë§ˆ ì „í™˜">ğŸŒ“</button>
    <div class="container">
        <header>
            <h1>âš™ï¸ ê´€ë¦¬ íˆ´</h1>
            <div class="nav-buttons">
                <button class="btn btn-primary" onclick="window.location.href='index.html'">â† ë©”ì¸ìœ¼ë¡œ</button>
                <button class="btn btn-danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </header>
        
        <div id="accessDenied" class="alert" style="display:none">
            âŒ ì ‘ê·¼ ê±°ë¶€: ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
        
        <div id="adminContent" style="display:none">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalPlugins">0</div>
                    <div class="stat-label">ì´ í”ŒëŸ¬ê·¸ì¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalDownloads">0</div>
                    <div class="stat-label">ì´ ë‹¤ìš´ë¡œë“œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">ì´ ì‚¬ìš©ì</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalNotices">0</div>
                    <div class="stat-label">ê³µì§€ì‚¬í•­</div>
                </div>
            </div>

            <!-- ê³µì§€ì‚¬í•­ ê´€ë¦¬ -->
            <div class="table-container">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                    <h2 style="color:var(--text-primary);margin:0">ğŸ“¢ ê³µì§€ì‚¬í•­ ê´€ë¦¬</h2>
                    <button class="btn btn-success" onclick="showAddNoticeModal()">+ ê³µì§€ ì¶”ê°€</button>
                </div>
                <div id="noticesList"></div>
            </div>

            <!-- í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ -->
            <div class="table-container">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                    <h2 style="color:var(--text-primary);margin:0">ğŸ”Œ í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€</h2>
                    <button class="btn btn-success" onclick="showAddPluginModal()">+ í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€</button>
                </div>
            </div>
            
            <div class="table-container">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                    <h2 style="color:var(--text-primary);margin:0">ğŸ‘¥ ìœ ì € ê´€ë¦¬</h2>
                    <button class="btn btn-primary" onclick="showAddUserModal()" style="background:#10b981">+ ìœ ì € ì¶”ê°€</button>
                </div>
                <div style="max-height:400px;overflow-y:auto">
                    <table>
                        <thead>
                            <tr>
                                <th>ë§ˆì¸í¬ë˜í”„íŠ¸ ID</th>
                                <th>Discord ID</th>
                                <th>ì”ì•¡</th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="usersBody"></tbody>
                    </table>
                </div>
            </div>
            
            <div class="table-container">
                <h2 style="margin-bottom:20px;color:var(--text-primary)">í”ŒëŸ¬ê·¸ì¸ ëª©ë¡</h2>
                <table id="pluginsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ì´ë¦„</th>
                            <th>ì¹´í…Œê³ ë¦¬</th>
                            <th>íƒ€ì…</th>
                            <th>ê°€ê²©</th>
                            <th>ë‹¤ìš´ë¡œë“œ</th>
                            <th>í‰ì </th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody id="pluginsBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ê³µì§€ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addNoticeModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom:20px;color:var(--text-primary)">ğŸ“¢ ê³µì§€ì‚¬í•­ ì¶”ê°€</h3>
            <div class="form-group">
                <label>ì œëª©</label>
                <input type="text" id="noticeTitle" placeholder="ê³µì§€ì‚¬í•­ ì œëª©">
            </div>
            <div class="form-group">
                <label>ë‚´ìš©</label>
                <textarea id="noticeContent" rows="5" placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©"></textarea>
            </div>
            <div class="form-group">
                <label>ì¤‘ìš”ë„</label>
                <select id="noticeImportance">
                    <option value="normal">ì¼ë°˜</option>
                    <option value="important">ì¤‘ìš”</option>
                </select>
            </div>
            <div style="display:flex;gap:10px;margin-top:20px">
                <button class="btn btn-primary" onclick="addNotice()" style="flex:1">ì¶”ê°€</button>
                <button class="btn btn-danger" onclick="closeAddNoticeModal()" style="flex:1">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addPluginModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom:20px;color:var(--text-primary)">ğŸ”Œ í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€</h3>
            <div class="form-group">
                <label>í”ŒëŸ¬ê·¸ì¸ ì´ë¦„</label>
                <input type="text" id="pluginName" placeholder="ì˜ˆ: TestPlugin">
            </div>
            <div class="form-group">
                <label>ì„¤ëª…</label>
                <textarea id="pluginDescription" rows="3" placeholder="í”ŒëŸ¬ê·¸ì¸ ì„¤ëª…"></textarea>
            </div>
            <div class="form-group">
                <label>ë²„ì „</label>
                <input type="text" id="pluginVersion" placeholder="ì˜ˆ: 1.0" value="1.0">
            </div>
            <div class="form-group">
                <label>ì¹´í…Œê³ ë¦¬</label>
                <select id="pluginCategory">
                    <option value="ê²Œì„í”Œë ˆì´">ê²Œì„í”Œë ˆì´</option>
                    <option value="ì‹œìŠ¤í…œ">ì‹œìŠ¤í…œ</option>
                    <option value="ì»¤ìŠ¤í…€">ì»¤ìŠ¤í…€</option>
                    <option value="RPG">RPG</option>
                    <option value="ê²½ì œ">ê²½ì œ</option>
                </select>
            </div>
            <div class="form-group">
                <label>íƒ€ì…</label>
                <select id="pluginType" onchange="togglePrice()">
                    <option value="free">ë¬´ë£Œ</option>
                    <option value="paid">ìœ ë£Œ</option>
                </select>
            </div>
            <div class="form-group" id="priceGroup" style="display:none">
                <label>ê°€ê²© (ì›)</label>
                <input type="number" id="pluginPrice" min="0" placeholder="0">
            </div>
            <div class="form-group">
                <label>ë‹¤ìš´ë¡œë“œ URL</label>
                <input type="text" id="pluginDownloadUrl" placeholder="https://...">
            </div>
            <div style="display:flex;gap:10px;margin-top:20px">
                <button class="btn btn-primary" onclick="addPlugin()" style="flex:1">ì¶”ê°€</button>
                <button class="btn btn-danger" onclick="closeAddPluginModal()" style="flex:1">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ìœ ì € ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom:20px;color:var(--text-primary)">ğŸ‘¤ ìœ ì € ì¶”ê°€</h3>
            <div class="form-group">
                <label>ë§ˆì¸í¬ë˜í”„íŠ¸ ID</label>
                <input type="text" id="newMcId" placeholder="ì˜ˆ: Player123">
            </div>
            <div class="form-group">
                <label>Discord ID (ì„ íƒì‚¬í•­)</label>
                <input type="text" id="newDiscordId" placeholder="ì„ íƒì‚¬í•­">
            </div>
            <div style="background:var(--bg-tertiary);padding:10px;border-radius:8px;margin-bottom:15px;font-size:0.9em;color:var(--text-secondary)">
                ğŸ’¡ ë§ˆì¸í¬ë˜í”„íŠ¸ ë‹‰ë„¤ì„ë§Œìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.
            </div>
            <div style="display:flex;gap:10px">
                <button class="btn btn-primary" onclick="addNewUser()" style="flex:1">ì¶”ê°€</button>
                <button class="btn btn-danger" onclick="closeAddUserModal()" style="flex:1">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ê°€ê²© í¸ì§‘ ëª¨ë‹¬ -->
    <div id="priceEditModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom:20px;color:var(--text-primary)">ğŸ’° ê°€ê²© ì„¤ì •</h3>
            <div class="form-group">
                <label>í”ŒëŸ¬ê·¸ì¸ ì´ë¦„</label>
                <input type="text" id="editPluginName" readonly>
            </div>
            <div class="form-group">
                <label>ê°€ê²© (ì›)</label>
                <input type="number" id="editPluginPrice" min="0" placeholder="0">
            </div>
            <div class="form-group">
                <label>íƒ€ì…</label>
                <select id="editPluginType">
                    <option value="free">ë¬´ë£Œ</option>
                    <option value="paid">ìœ ë£Œ</option>
                </select>
            </div>
            <div style="display:flex;gap:10px;margin-top:20px">
                <button class="btn btn-primary" onclick="savePriceEdit()" style="flex:1">ì €ì¥</button>
                <button class="btn btn-danger" onclick="closePriceEditModal()" style="flex:1">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyB_FsD_GqnENdMGeuzH5Q8tICxn_fgu7OQ",
        authDomain: "plugmarketdb.firebaseapp.com",
        databaseURL: "https://plugmarketdb-default-rtdb.firebaseio.com",
        projectId: "plugmarketdb",
        storageBucket: "plugmarketdb.firebasestorage.app",
        messagingSenderId: "142551495005",
        appId: "1:142551495005:web:6b2b02b9ea53b4198138b4",
        measurementId: "G-3YMWZPCFWQ"
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const ADMIN_DISCORD_ID = '787223885766328340';
    
    let currentUser = null;
    let plugins = {};
    let users = {};
    let notices = {};
    
    function checkAdmin(){
        const user = localStorage.getItem('currentUser');
        if(!user) return false;
        currentUser = JSON.parse(user);
        return currentUser.discordId === ADMIN_DISCORD_ID;
    }
    
    function loadPlugins(){
        const stored = localStorage.getItem('plugins');
        if(stored) plugins = JSON.parse(stored);
        return plugins;
    }
    
    function loadUsers(){
        const stored = localStorage.getItem('allUsers');
        if(stored) users = JSON.parse(stored);
        renderUsersTable();
    }
    
    function loadNotices(){
        const stored = localStorage.getItem('notices');
        if(stored) notices = JSON.parse(stored);
        else notices = {};
        renderNotices();
    }
    
    function saveUsers(){
        localStorage.setItem('allUsers', JSON.stringify(users));
    }
    
    function saveNotices(){
        localStorage.setItem('notices', JSON.stringify(notices));
    }
    
    function renderStats(){
        const pluginCount = Object.keys(plugins).length;
        const totalDownloads = Object.values(plugins).reduce((sum, p) => sum + (p.downloads || 0), 0);
        const userCount = Object.keys(users).length;
        const noticeCount = Object.keys(notices).length;
        
        document.getElementById('totalPlugins').textContent = pluginCount;
        document.getElementById('totalDownloads').textContent = totalDownloads;
        document.getElementById('totalUsers').textContent = userCount;
        document.getElementById('totalNotices').textContent = noticeCount;
    }
    
    function renderNotices(){
        const container = document.getElementById('noticesList');
        const noticeList = Object.values(notices);
        
        if(noticeList.length === 0){
            container.innerHTML = '<p style="text-align:center;color:var(--text-secondary);padding:20px">ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            return;
        }
        
        container.innerHTML = noticeList.map(n => {
            const importanceBadge = n.importance === 'important' 
                ? '<span class="badge badge-warning">ì¤‘ìš”</span>' 
                : '<span class="badge badge-success">ì¼ë°˜</span>';
            return `
                <div class="notice-item">
                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px">
                        <div>
                            <h4 style="color:var(--text-primary);margin-bottom:5px">${n.title}</h4>
                            ${importanceBadge}
                        </div>
                        <button class="btn btn-danger" onclick="deleteNotice('${n.id}')" style="padding:5px 10px;font-size:0.85em">ì‚­ì œ</button>
                    </div>
                    <p style="color:var(--text-secondary);margin-bottom:5px">${n.content}</p>
                    <p style="color:var(--text-secondary);font-size:0.85em">${n.date}</p>
                </div>
            `;
        }).join('');
    }
    
    function renderUsersTable(){
        const tbody = document.getElementById('usersBody');
        const userList = Object.values(users);
        
        if(userList.length === 0){
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-secondary)">ë“±ë¡ëœ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
            return;
        }
        
        tbody.innerHTML = userList.map(user => `
            <tr>
                <td><strong>${user.minecraftId || user.actualMcName || '-'}</strong></td>
                <td>${user.discordId || '-'}</td>
                <td style="color:#10b981;font-weight:bold">${(user.balance || 0).toLocaleString()}ì›</td>
                <td>
                    <button class="btn btn-primary" onclick="resetBalanceToZero('${user.minecraftId}')" style="background:#6b7280;font-size:0.9em;padding:8px 15px">0ì›ìœ¼ë¡œ ì´ˆê¸°í™”</button>
                    <button class="btn btn-primary" onclick="addMoneyToUser('${user.minecraftId}', 1000)" style="background:#10b981;font-size:0.9em;padding:8px 15px">+1,000ì›</button>
                    <button class="btn btn-primary" onclick="addMoneyToUser('${user.minecraftId}', 2000)" style="background:#3b82f6;font-size:0.9em;padding:8px 15px">+2,000ì›</button>
                    <button class="btn btn-primary" onclick="addMoneyToUser('${user.minecraftId}', 5000)" style="background:#8b5cf6;font-size:0.9em;padding:8px 15px">+5,000ì›</button>
                    <button class="btn btn-primary" onclick="deleteUser('${user.minecraftId}')" style="background:#ef4444;font-size:0.9em;padding:8px 15px">ìœ ì € ì‚­ì œ</button>
                </td>
            </tr>
        `).join('');
    }
    
    function renderPluginsTable(){
        const tbody = document.getElementById('pluginsBody');
        tbody.innerHTML = Object.values(plugins).map(p => `
            <tr>
                <td>${p.id}</td>
                <td><strong>${p.name}</strong></td>
                <td><span class="badge badge-success">${p.category}</span></td>
                <td>${p.type === 'free' ? 'ë¬´ë£Œ' : 'ìœ ë£Œ'}</td>
                <td><strong style="color:#f59e0b">${(p.price || 0).toLocaleString()}ì›</strong></td>
                <td>${p.downloads || 0}</td>
                <td>${(p.rating || 0).toFixed(1)}</td>
                <td>
                    <button class="btn btn-primary" onclick="editPluginPrice('${p.id}')" style="background:#f59e0b;font-size:0.9em;padding:8px 15px">ê°€ê²© ìˆ˜ì •</button>
                    <button class="btn btn-primary" onclick="resetDownloads('${p.id}')" style="font-size:0.9em;padding:8px 15px">ë‹¤ìš´ë¡œë“œ ì´ˆê¸°í™”</button>
                </td>
            </tr>
        `).join('');
    }
    
    window.showAddNoticeModal = function(){
        document.getElementById('addNoticeModal').classList.add('active');
    };
    
    function closeAddNoticeModal(){
        document.getElementById('addNoticeModal').classList.remove('active');
        document.getElementById('noticeTitle').value = '';
        document.getElementById('noticeContent').value = '';
        document.getElementById('noticeImportance').value = 'normal';
    }
    
    async function addNotice(){
        const title = document.getElementById('noticeTitle').value.trim();
        const content = document.getElementById('noticeContent').value.trim();
        const importance = document.getElementById('noticeImportance').value;
        
        if(!title || !content){
            alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
        }
        
        const id = 'n' + Date.now();
        notices[id] = {
            id,
            title,
            content,
            importance,
            date: new Date().toLocaleString('ko-KR')
        };
        
        saveNotices();
        
        try {
            await database.ref(`notices/${id}`).set(notices[id]);
        } catch(e) {
            console.log('â„¹ï¸ Firebase ì €ì¥ ë¶ˆê°€');
        }
        
        renderNotices();
        renderStats();
        closeAddNoticeModal();
        alert('âœ… ê³µì§€ì‚¬í•­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
    
    async function deleteNotice(id){
        if(!confirm('ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        
        delete notices[id];
        saveNotices();
        
        try {
            await database.ref(`notices/${id}`).remove();
        } catch(e) {
            console.log('â„¹ï¸ Firebase ì‚­ì œ ë¶ˆê°€');
        }
        
        renderNotices();
        renderStats();
        alert('âœ… ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
    
    window.showAddPluginModal = function(){
        document.getElementById('addPluginModal').classList.add('active');
    };
    
    function closeAddPluginModal(){
        document.getElementById('addPluginModal').classList.remove('active');
        document.getElementById('pluginName').value = '';
        document.getElementById('pluginDescription').value = '';
        document.getElementById('pluginVersion').value = '1.0';
        document.getElementById('pluginCategory').value = 'ê²Œì„í”Œë ˆì´';
        document.getElementById('pluginType').value = 'free';
        document.getElementById('pluginPrice').value = '';
        document.getElementById('pluginDownloadUrl').value = '';
        document.getElementById('priceGroup').style.display = 'none';
    }
    
    function togglePrice(){
        const type = document.getElementById('pluginType').value;
        document.getElementById('priceGroup').style.display = type === 'paid' ? 'block' : 'none';
    }
    
    async function addPlugin(){
        const name = document.getElementById('pluginName').value.trim();
        const description = document.getElementById('pluginDescription').value.trim();
        const version = document.getElementById('pluginVersion').value.trim();
        const category = document.getElementById('pluginCategory').value;
        const type = document.getElementById('pluginType').value;
        const price = type === 'paid' ? parseInt(document.getElementById('pluginPrice').value) || 0 : 0;
        const downloadUrl = document.getElementById('pluginDownloadUrl').value.trim();
        
        if(!name || !description || !downloadUrl){
            alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
        }
        
        const id = 'p' + Date.now();
        plugins[id] = {
            id,
            name,
            description,
            version,
            type,
            price,
            category,
            downloads: 0,
            rating: 0,
            reviews: {},
            downloadUrl
        };
        
        localStorage.setItem('plugins', JSON.stringify(plugins));
        
        try {
            await database.ref(`plugins/${id}`).set(plugins[id]);
        } catch(e) {
            console.log('â„¹ï¸ Firebase ì €ì¥ ë¶ˆê°€');
        }
        
        renderPluginsTable();
        renderStats();
        closeAddPluginModal();
        alert('âœ… í”ŒëŸ¬ê·¸ì¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
    
    function showAddUserModal(){
        document.getElementById('addUserModal').classList.add('active');
    }
    
    function closeAddUserModal(){
        document.getElementById('addUserModal').classList.remove('active');
        document.getElementById('newMcId').value = '';
        document.getElementById('newDiscordId').value = '';
    }
    
    async function addNewUser(){
        const mcId = document.getElementById('newMcId').value.trim();
        const discordId = document.getElementById('newDiscordId').value.trim();
        
        if(!mcId){
            alert('ë§ˆì¸í¬ë˜í”„íŠ¸ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
        }
        
        if(users[mcId]){
            alert('ì´ë¯¸ ë“±ë¡ëœ ìœ ì €ì…ë‹ˆë‹¤');
            return;
        }
        
        users[mcId] = {
            minecraftId: mcId,
            discordId: discordId || '',
            balance: 0,
            registeredDate: new Date().toISOString()
        };
        
        saveUsers();
        renderUsersTable();
        renderStats();
        
        try {
            await database.ref(`users/${mcId}`).set(users[mcId]);
        } catch(e) {
            console.log('â„¹ï¸ Firebase ì €ì¥ ë¶ˆê°€');
        }
        
        closeAddUserModal();
        alert(`âœ… ${mcId} ìœ ì € ì¶”ê°€ ì™„ë£Œ!`);
    }
    
    async function addMoneyToUser(minecraftId, amount){
        if(!confirm(`${minecraftId}ë‹˜ì—ê²Œ ${amount.toLocaleString()}ì›ì„ ì§€ê¸‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        
        if(!users[minecraftId]){
            users[minecraftId] = {
                minecraftId: minecraftId,
                balance: 0
            };
        }
        
        users[minecraftId].balance = (users[minecraftId].balance || 0) + amount;
        saveUsers();
        renderUsersTable();
        renderStats();
        
        try {
            await database.ref(`users/${minecraftId}`).set(users[minecraftId]);
        } catch(e) {
            console.log('â„¹ï¸ Firebase ì €ì¥ ë¶ˆê°€');
        }
        
        alert(`âœ… ${minecraftId}ë‹˜ì—ê²Œ ${amount.toLocaleString()}ì› ì§€ê¸‰ ì™„ë£Œ!`);
    }
    
    async function resetBalanceToZero(minecraftId){
        if(!confirm(`${minecraftId}ë‹˜ì˜ ì”ì•¡ì„ 0ì›ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        
        if(!users[minecraftId]){    
            alert('ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        users[minecraftId].balance = 0;
        saveUsers();
        renderUsersTable();
        renderStats();
        
        try {
            await database.ref(`users/${minecraftId}`).update({
                balance: 0
            });
        } catch(e) {
            console.log('â„¹ï¸ Firebase ì €ì¥ ë¶ˆê°€');
        }
        
        alert(`âœ… ${minecraftId}ë‹˜ì˜ ì”ì•¡ì´ 0ì›ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    }

    async function deleteUser(minecraftId){
        if(!confirm(`${minecraftId} ìœ ì €ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        if(users[minecraftId]){ delete users[minecraftId]; }
        saveUsers();
        renderUsersTable();
        renderStats();
        try { await database.ref(`users/${minecraftId}`).remove(); } catch(e) { console.log('â„¹ï¸ Firebase ì‚­ì œ ë¶ˆê°€'); }
        alert(`âœ… ${minecraftId} ìœ ì € ì‚­ì œ ì™„ë£Œ!`);
    }
    
    let currentEditingPluginId = null;
    
    function editPluginPrice(pluginId){
        currentEditingPluginId = pluginId;
        const plugin = plugins[pluginId];
        
        document.getElementById('editPluginName').value = plugin.name;
        document.getElementById('editPluginPrice').value = plugin.price || 0;
        document.getElementById('editPluginType').value = plugin.type || 'free';
        
        document.getElementById('priceEditModal').classList.add('active');
    }
    
    function closePriceEditModal(){
        document.getElementById('priceEditModal').classList.remove('active');
        currentEditingPluginId = null;
    }
    
    async function savePriceEdit(){
        const newPrice = parseInt(document.getElementById('editPluginPrice').value) || 0;
        const newType = document.getElementById('editPluginType').value;
        
        if(newType === 'paid' && newPrice <= 0){
            alert('ìœ ë£Œ í”ŒëŸ¬ê·¸ì¸ì€ ê°€ê²©ì„ 0ë³´ë‹¤ í¬ê²Œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.');
            return;
        }
        
        if(!confirm(`ê°€ê²©ì„ ${newPrice.toLocaleString()}ì›ìœ¼ë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        
        plugins[currentEditingPluginId].price = newPrice;
        plugins[currentEditingPluginId].type = newType;
        
        if(newType === 'free'){
            plugins[currentEditingPluginId].price = 0;
        }
        
        localStorage.setItem('plugins', JSON.stringify(plugins));
        
        try {
            await database.ref(`plugins/${currentEditingPluginId}`).update({
                price: plugins[currentEditingPluginId].price,
                type: plugins[currentEditingPluginId].type
            });
        } catch(e) {
            console.log('â„¹ï¸ Firebase ì—…ë°ì´íŠ¸ ë¶ˆê°€');
        }
        
        renderStats();
        renderPluginsTable();
        closePriceEditModal();
        alert('ê°€ê²© ì„¤ì • ì™„ë£Œ!');
    }
    
    async function resetDownloads(pluginId){
        if(!confirm(`${plugins[pluginId].name}ì˜ ë‹¤ìš´ë¡œë“œ íšŸìˆ˜ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        
        plugins[pluginId].downloads = 0;
        localStorage.setItem('plugins', JSON.stringify(plugins));
        
        try {
            await database.ref(`plugins/${pluginId}/downloads`).set(0);
        } catch(e) {
            console.log('â„¹ï¸ Firebase ì—…ë°ì´íŠ¸ ë¶ˆê°€');
        }
        
        renderStats();
        renderPluginsTable();
        alert('ì´ˆê¸°í™” ì™„ë£Œ!');
    }
    
    function logout(){
        if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }
    }
    
    function toggleTheme(){
        const body = document.body;
        const isDark = body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        updateThemeIcon();
    }
    
    function updateThemeIcon(){
        const toggle = document.querySelector('.theme-toggle');
        if(document.body.classList.contains('dark-mode')){
            toggle.textContent = 'â˜€ï¸';
        } else {
            toggle.textContent = 'ğŸŒ“';
        }
    }
    
    function loadTheme(){
        const savedTheme = localStorage.getItem('theme');
        if(savedTheme === 'dark'){
            document.body.classList.add('dark-mode');
        }
        updateThemeIcon();
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
        loadTheme();
        
        const isAdmin = checkAdmin();
        
        if(!isAdmin){
            document.getElementById('accessDenied').style.display = 'block';
        } else {
            document.getElementById('adminContent').style.display = 'block';
            loadPlugins();
            loadUsers();
            loadNotices();
            renderStats();
            renderPluginsTable();
        }
    });
    </script>
</body>
</html>
