<html lang="ko"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plugin Store</title>
    <style>
        :root{
            --bg-primary:#ffffff;
            --bg-secondary:#ffffff;
            --bg-tertiary:#f9fafb;
            --text-primary:#333;
            --text-secondary:#666;
            --text-tertiary:#999;
            --border-color:#e5e7eb;
            --shadow:rgba(0,0,0,0.08);
            --shadow-hover:rgba(0,0,0,0.12);
            --card-bg:#ffffff;
            --input-bg:#ffffff;
            --tag-bg:#f3f4f6;
            --tag-hover:#e5e7eb;
            --review-bg:#f9fafb;
            --footer-bg:#6b7280;
        }
        body.dark-mode{
            --bg-primary:#1a1a1a;
            --bg-secondary:#2d2d2d;
            --bg-tertiary:#383838;
            --text-primary:#e5e5e5;
            --text-secondary:#b3b3b3;
            --text-tertiary:#808080;
            --border-color:#404040;
            --shadow:rgba(0,0,0,0.3);
            --shadow-hover:rgba(0,0,0,0.5);
            --card-bg:#2d2d2d;
            --input-bg:#383838;
            --tag-bg:#404040;
            --tag-hover:#4a4a4a;
            --review-bg:#383838;
            --footer-bg:#1f1f1f;
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:var(--bg-primary);min-height:100vh;padding:20px;padding-bottom:80px;transition:background 0.3s ease}
        .container{max-width:1400px;margin:0 auto}
        header{background:var(--bg-secondary);padding:30px;border-radius:20px;box-shadow:0 2px 10px var(--shadow);margin-bottom:30px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px;border:1px solid var(--border-color);transition:all 0.3s ease}
        .header-left h1{color:#667eea;font-size:2.5em;margin-bottom:10px}
        .subtitle{color:var(--text-secondary);font-size:1.1em}
        .user-info{text-align:right}
        .user-name{font-size:1.2em;color:var(--text-primary);margin-bottom:5px}
        .user-id{color:var(--text-secondary);font-size:0.9em}
.user-stats{display:flex;gap:8px;margin-top:6px;font-size:0.9em}
.stat-item{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:4px 10px;border-radius:12px}
        .btn-logout{margin-top:10px;padding:8px 20px;background:#ef4444;color:white;border:none;border-radius:8px;cursor:pointer;font-size:0.9em}
        .btn-logout:hover{background:#dc2626}
        .theme-toggle{position:fixed;top:20px;right:20px;background:var(--card-bg);border:2px solid var(--border-color);padding:12px 16px;border-radius:50px;cursor:pointer;font-size:1.5em;box-shadow:0 4px 15px var(--shadow);z-index:1000;transition:all 0.3s ease}
        .theme-toggle:hover{transform:scale(1.1);box-shadow:0 6px 20px var(--shadow-hover)}
        .search-section{background:var(--card-bg);padding:20px;border-radius:15px;margin-bottom:20px;box-shadow:0 2px 10px var(--shadow);border:1px solid var(--border-color);transition:all 0.3s ease}
        .search-bar{display:flex;gap:10px;margin-bottom:15px}
        .search-input{flex:1;padding:15px;border:2px solid var(--border-color);border-radius:10px;font-size:1em;background:var(--input-bg);color:var(--text-primary);transition:all 0.3s ease}
        .search-input:focus{outline:none;border-color:#667eea}
        .btn-search{padding:15px 30px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:10px;cursor:pointer;font-size:1em;font-weight:bold}
        .category-tags{display:flex;gap:10px;flex-wrap:wrap}
        .category-tag{padding:8px 15px;background:var(--tag-bg);border:none;border-radius:20px;cursor:pointer;font-size:0.9em;color:var(--text-primary);transition:all 0.3s ease}
        .category-tag:hover{background:var(--tag-hover)}
        .category-tag.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
        .filters{display:flex;gap:15px;margin-bottom:30px;flex-wrap:wrap;align-items:center}
        .filter-btn{background:var(--card-bg);border:1px solid var(--border-color);padding:12px 25px;border-radius:25px;cursor:pointer;font-size:1em;box-shadow:0 2px 8px var(--shadow);color:var(--text-primary);transition:all 0.3s ease}
        .filter-btn:hover{transform:translateY(-2px);box-shadow:0 3px 10px var(--shadow-hover)}
        .filter-btn.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none}
        .sort-select{padding:12px 20px;border:1px solid var(--border-color);border-radius:25px;background:var(--card-bg);cursor:pointer;font-size:1em;box-shadow:0 2px 8px var(--shadow);color:var(--text-primary);transition:all 0.3s ease}
        .plugins-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:25px;margin-bottom:30px}
        .plugin-card{background:var(--card-bg);border-radius:15px;padding:25px;box-shadow:0 2px 10px var(--shadow);border:1px solid var(--border-color);transition:all 0.3s}
        .plugin-card:hover{transform:translateY(-3px);box-shadow:0 4px 15px var(--shadow-hover)}
        .plugin-title{font-size:1.5em;color:var(--text-primary);margin-bottom:5px}
        .plugin-badge{padding:5px 15px;border-radius:20px;font-size:0.85em;font-weight:bold;background:#10b981;color:white}
        .plugin-category{display:inline-block;padding:3px 10px;background:var(--tag-bg);border-radius:10px;font-size:0.8em;color:var(--text-secondary);margin-bottom:10px}
        .plugin-description{color:var(--text-secondary);margin-bottom:15px;line-height:1.6}
        .plugin-version{color:var(--text-tertiary);font-size:0.9em;margin-bottom:15px}
        .plugin-rating{display:flex;align-items:center;gap:5px;margin-bottom:10px}
        .stars{color:#fbbf24}
        .rating-count{color:var(--text-tertiary);font-size:0.9em}
        .plugin-downloads{color:var(--text-secondary);font-size:0.9em;margin-bottom:15px}
        .plugin-footer{display:flex;gap:10px}
        .btn{flex:1;padding:12px;border:none;border-radius:10px;cursor:pointer;font-size:1em;font-weight:bold;transition:all 0.3s}
        .btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
        .btn-primary:hover{transform:scale(1.05)}
        .btn-secondary{background:var(--tag-bg);color:#667eea}
        .btn-secondary:hover{background:var(--tag-hover)}
        .icon{display:inline-flex;align-items:center;justify-content:center;margin-right:8px}
        .icon svg{width:18px;height:18px;display:inline-block}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:center;align-items:center}
        .modal.active{display:flex}
        .modal-content{background:var(--card-bg);padding:40px;border-radius:20px;max-width:600px;width:90%;max-height:85vh;overflow-y:auto;box-shadow:0 4px 20px rgba(0,0,0,0.15);transition:all 0.3s ease}
        .modal-header{font-size:1.8em;margin-bottom:20px;color:var(--text-primary)}
        .modal-body{margin-bottom:20px;line-height:1.8;color:var(--text-secondary)}
        .modal-footer{display:flex;gap:10px}
        .form-group{display:flex;flex-direction:column;gap:5px}
        .form-group label{color:var(--text-primary);font-weight:bold}
        .form-group textarea{padding:12px;border:2px solid var(--border-color);border-radius:8px;font-size:1em;font-family:inherit;background:var(--input-bg);color:var(--text-primary);transition:all 0.3s ease}
        .form-group textarea:focus{outline:none;border-color:#667eea}
        .star-rating{display:flex;gap:5px;font-size:2em}
        .star{cursor:pointer;color:#d1d5db}
        .star:hover,.star.active{color:#fbbf24}
        .reviews-section{margin-top:20px;padding-top:20px;border-top:2px solid var(--border-color)}
        .review-item{background:var(--review-bg);padding:15px;border-radius:10px;margin-bottom:15px}
        .review-header{display:flex;justify-content:space-between;margin-bottom:10px}
        .review-author{font-weight:bold;color:var(--text-primary)}
        .review-date{color:var(--text-tertiary);font-size:0.9em}
        .review-text{color:var(--text-secondary);line-height:1.6}
        .history-btn{position:fixed;bottom:90px;right:30px;background:var(--card-bg);padding:15px 20px;border-radius:30px;box-shadow:0 2px 15px var(--shadow);cursor:pointer;z-index:100;font-weight:bold;color:#667eea;border:1px solid var(--border-color);transition:all 0.3s ease;font-size:1em}
        .history-btn:hover{transform:translateY(-3px);box-shadow:0 4px 20px var(--shadow-hover);background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
        .history-item{background:var(--review-bg);padding:20px;border-radius:10px;margin-bottom:15px;border-left:4px solid #667eea}
        footer{position:fixed;bottom:0;left:0;width:100%;background:var(--footer-bg);color:white;padding:20px;text-align:center;box-shadow:0 -2px 10px rgba(0,0,0,0.1);transition:all 0.3s ease}
        @media(max-width:768px){.plugins-grid{grid-template-columns:1fr}header{flex-direction:column;text-align:center}.theme-toggle{top:10px;right:10px;padding:10px 14px}}
    </style>
<script src="https://www.googletagmanager.com/gtag/js?l=dataLayer&amp;id=G-3YMWZPCFWQ" async=""></script></head>
<body class="dark-mode">
    <button class="theme-toggle" onclick="toggleTheme()" title="ÌÖåÎßà Ï†ÑÌôò"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path></svg></span></button>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üéÆ Plugin Store</h1>
                <p class="subtitle">ÎßàÏù∏ÌÅ¨ÎûòÌîÑÌä∏ ÌîåÎü¨Í∑∏Ïù∏ Ïä§ÌÜ†Ïñ¥</p>
            </div>
            <div class="user-info" id="userInfo">
                <p class="user-name" id="userName">gogaonÎãò</p>
                <p class="user-id" id="userIdDisplay">MC: gogaon</p>
                <div class="user-stats">
                    <span class="stat-item"><span class="icon" data-icon="wallet"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7h18v10H3z"></path><path d="M16 7V4H8v3"></path></svg></span> <span id="userBalance">0</span>Ïõê</span>
                    <span class="stat-item"><span class="icon" data-icon="download"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span> <span id="downloadCount">0</span>Í∞ú</span>
                    <span class="stat-item"><span class="icon" data-icon="star"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></svg></span> <span id="avgRating">0.0</span></span>
                </div>
                <button id="btnCharge" class="btn-logout" onclick="requestCharge()" style="background:#10b981;margin-bottom:5px"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"></rect><path d="M2 10h20"></path><path d="M6 15h4"></path></svg></span>Ï∂©Ï†Ñ ÏöîÏ≤≠</button>
                <button id="btnMyPage" class="btn-logout" onclick="window.location.href='MyAccount.html'" style="background:#3b82f6;margin-bottom:5px"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"></circle><path d="M4 20a8 8 0 0 1 16 0"></path></svg></span>ÎßàÏù¥ÌéòÏù¥ÏßÄ</button>
                <button id="btnLogout" class="btn-logout" onclick="logout()"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><path d="M16 17l5-5-5-5"></path><path d="M21 12H9"></path></svg></span>Î°úÍ∑∏ÏïÑÏõÉ</button>
            <button id="adminBtn" class="btn-logout" style="margin-top: 10px;">‚öôÔ∏è Í¥ÄÎ¶¨ Ìà¥</button></div>
        </header>
        <div class="search-section">
            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="Í≤ÄÏÉâ...">
                <button id="btnSearch" class="btn-search" onclick="searchPlugins()"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"></circle><path d="M21 21l-4.3-4.3"></path></svg></span></button>
            </div>
            <div class="category-tags">
                <button class="category-tag active" data-category="all">Ï†ÑÏ≤¥</button>
                <button class="category-tag" data-category="Í≤åÏûÑÌîåÎ†àÏù¥">Í≤åÏûÑÌîåÎ†àÏù¥</button>
                <button class="category-tag" data-category="ÏãúÏä§ÌÖú">ÏãúÏä§ÌÖú</button>
                <button class="category-tag" data-category="Ïª§Ïä§ÌÖÄ">Ïª§Ïä§ÌÖÄ</button>
                <button class="category-tag" data-category="RPG">RPG</button>
                <button class="category-tag" data-category="Í≤ΩÏ†ú">Í≤ΩÏ†ú</button>
            </div>
        </div>
        <div class="filters">
            <button class="filter-btn active" data-filter="all">Ï†ÑÏ≤¥</button>
            <button class="filter-btn" data-filter="free">Î¨¥Î£å</button>
            <button class="filter-btn" data-filter="premium">ÌîÑÎ¶¨ÎØ∏ÏóÑ</button>
            <button class="filter-btn" data-filter="downloaded">Îã§Ïö¥Î°úÎìúÌï®</button>
            <select class="sort-select" id="sortSelect">
                <option value="popular">Ïù∏Í∏∞Ïàú</option>
                <option value="rating">ÌèâÏ†êÏàú</option>
                <option value="downloads">Îã§Ïö¥Î°úÎìúÏàú</option>
            </select>
        </div>
        <div class="plugins-grid" id="pluginsGrid"><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">CookingPlugin</h3><span class="plugin-category">Í≤åÏûÑÌîåÎ†àÏù¥</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">ÏöîÎ¶¨ ÏãúÏä§ÌÖú</p><p class="plugin-version">v1.0</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p1" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p1" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">ItemsAdder</h3><span class="plugin-category">Ïª§Ïä§ÌÖÄ</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">Ïª§Ïä§ÌÖÄ ÏïÑÏù¥ÌÖú</p><p class="plugin-version">v1.2</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p2" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p2" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">QuestPlugin</h3><span class="plugin-category">RPG</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">ÌÄòÏä§Ìä∏ ÏãúÏä§ÌÖú</p><p class="plugin-version">v1.5</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p3" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p3" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">RankPlugin</h3><span class="plugin-category">ÏãúÏä§ÌÖú</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">Îì±Í∏â ÏãúÏä§ÌÖú</p><p class="plugin-version">v1.0</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p4" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p4" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">RoulettePlugin</h3><span class="plugin-category">Í≤åÏûÑÌîåÎ†àÏù¥</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">Î£∞Î†õ</p><p class="plugin-version">v1.0</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p5" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p5" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">ShopSystem</h3><span class="plugin-category">Í≤ΩÏ†ú</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">ÏÉÅÏ†ê</p><p class="plugin-version">v1.2</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p6" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p6" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">SkillSystem</h3><span class="plugin-category">RPG</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">Ïä§ÌÇ¨</p><p class="plugin-version">v1.0</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p7" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p7" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">SpectatorOnDeath</h3><span class="plugin-category">Í≤åÏûÑÌîåÎ†àÏù¥</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">Í¥ÄÏ†Ñ</p><p class="plugin-version">v1.0</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p8" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p8" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">SwordPlugin</h3><span class="plugin-category">Ïª§Ïä§ÌÖÄ</span></div><span class="plugin-badge" style="background:#10b981">Î¨¥Î£å</span></div><p class="plugin-description">Í≤Ä</p><p class="plugin-version">v1.2</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>0Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p9" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>Îã§Ïö¥Î°úÎìú</button><button class="btn btn-secondary" data-plugin-id="p9" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">PartyPlugin</h3><span class="plugin-category">Í≤åÏûÑÌîåÎ†àÏù¥</span></div><span class="plugin-badge" style="background:#f59e0b">2,000Ïõê</span></div><p class="plugin-description">ÌååÌã∞ ÌîåÎü¨Í∑∏Ïù∏</p><p class="plugin-version">v1.0 ‚Ä¢ 3Í∞ú ÎßàÏù∏ÌÅ¨ÎûòÌîÑÌä∏ Î≤ÑÏ†Ñ ÏßÄÏõê</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>3Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p10" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 6h15l-1.5 9H7.5L6 6z"></path><circle cx="9" cy="20" r="1"></circle><circle cx="18" cy="20" r="1"></circle><path d="M6 6L5 3H3"></path></svg></span>Íµ¨Îß§</button><button class="btn btn-secondary" data-plugin-id="p10" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">GuildPlugin</h3><span class="plugin-category">ÏãúÏä§ÌÖú</span></div><span class="plugin-badge" style="background:#f59e0b">2,000Ïõê</span></div><p class="plugin-description">Í∏∏Îìú ÌîåÎü¨Í∑∏Ïù∏</p><p class="plugin-version">v1.2</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>2Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p11" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 6h15l-1.5 9H7.5L6 6z"></path><circle cx="9" cy="20" r="1"></circle><circle cx="18" cy="20" r="1"></circle><path d="M6 6L5 3H3"></path></svg></span>Íµ¨Îß§</button><button class="btn btn-secondary" data-plugin-id="p11" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div><div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">FriendPlugin</h3><span class="plugin-category">ÏãúÏä§ÌÖú</span></div><span class="plugin-badge" style="background:#f59e0b">2,000Ïõê</span></div><p class="plugin-description">ÏπúÍµ¨ ÌîåÎü¨Í∑∏Ïù∏</p><p class="plugin-version">v1.1</p><div class="plugin-rating"><span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span><span class="rating-count">0.0(0)</span></div><p class="plugin-downloads"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg></span>1Ìöå</p><div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="p12" data-action="download"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 6h15l-1.5 9H7.5L6 6z"></path><circle cx="9" cy="20" r="1"></circle><circle cx="18" cy="20" r="1"></circle><path d="M6 6L5 3H3"></path></svg></span>Íµ¨Îß§</button><button class="btn btn-secondary" data-plugin-id="p12" data-action="detail"><span class="icon"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span>ÏÉÅÏÑ∏Î≥¥Í∏∞</button></div></div></div>
    </div>
    <footer>
        <p>ÎåÄÌëú Í≥†Í∞ÄÏò® | Ïù¥Î©îÏùº: <a href="mailto:gogaon036@gmail.com">gogaon036@gmail.com</a></p>
    </footer>
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <h2 class="modal-header" id="modalTitle"></h2>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDetailModal()">Îã´Í∏∞</button>
                <button class="btn btn-primary" id="modalAction"></button>
            </div>
        </div>
    </div>
    <div class="modal" id="reviewModal">
        <div class="modal-content">
            <h2 class="modal-header">‚≠ê Î¶¨Î∑∞ ÏûëÏÑ±</h2>
            <div class="modal-body">
                <div class="form-group">
                    <label>ÌèâÏ†ê</label>
                    <div class="star-rating" id="starRating">
                        <span class="star" data-rating="1">‚òÖ</span>
                        <span class="star" data-rating="2">‚òÖ</span>
                        <span class="star" data-rating="3">‚òÖ</span>
                        <span class="star" data-rating="4">‚òÖ</span>
                        <span class="star" data-rating="5">‚òÖ</span>
                    </div>
                </div>
                <div class="form-group"><label>Î¶¨Î∑∞</label><textarea id="reviewText" rows="5"></textarea></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeReviewModal()">Ï∑®ÏÜå</button>
                <button class="btn btn-primary" onclick="submitReview()">Îì±Î°ù</button>
            </div>
        </div>
    </div>
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <h2 class="modal-header">üìú ÎÇ¥ Îã§Ïö¥Î°úÎìú ÎÇ¥Ïó≠</h2>
            <div class="modal-body" id="historyBody"></div>
            <div class="modal-footer"><button class="btn btn-primary" onclick="closeHistoryModal()">Îã´Í∏∞</button></div>
        </div>
    </div>
    <div class="modal" id="chargeModal">
        <div class="modal-content">
            <h2 class="modal-header" style="color:#667eea">üí∞ Í≥ÑÏ¢å Ï∂©Ï†Ñ</h2>
            <div class="modal-body">
                <div class="form-group">
                    <label style="color:var(--text-primary);font-weight:bold">ÏûÖÍ∏à Ïãú ÏÇ¨Ïö©Ìï† Ïù¥Î¶Ñ</label>
                    <input type="text" id="chargeName" placeholder="ÌôçÍ∏∏Îèô" style="width:100%;padding:12px;border:2px solid var(--border-color);border-radius:8px;font-size:1em;background:var(--input-bg);color:var(--text-primary);transition:all 0.3s ease" value="">
                </div>
                <div class="form-group" style="margin-top:15px">
                    <label style="color:var(--text-primary);font-weight:bold">Ï∂©Ï†Ñ Í∏àÏï°(Ïõê)</label>
                    <input type="number" id="chargeAmount" placeholder="10000" min="0" style="width:100%;padding:12px;border:2px solid var(--border-color);border-radius:8px;font-size:1em;background:var(--input-bg);color:var(--text-primary);transition:all 0.3s ease" value="">
                </div>
                <div style="background:#e3f2fd;padding:15px;border-radius:10px;margin-top:20px;border-left:4px solid #667eea">
                    <p style="margin-bottom:10px;font-weight:bold;color:var(--text-primary)">üí≥ ÏûÖÍ∏à Í≥ÑÏ¢å Ï†ïÎ≥¥</p>
                    <p style="margin:0;color:var(--text-secondary)">Íµ≠ÎØºÏùÄÌñâ: 7018-9074-0985-68</p>
                    <p style="margin:5px 0 0 0;font-size:0.9em;color:var(--text-tertiary)">‚ö†Ô∏è ÏûÖÍ∏à Ïãú ÏúÑ Ïù¥Î¶ÑÏúºÎ°ú ÏûÖÍ∏àÌï¥Ï£ºÏÑ∏Ïöî</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeChargeModal()">Ï∑®ÏÜå</button>
                <button class="btn btn-primary" onclick="submitChargeRequest()">Ï∂©Ï†Ñ ÏöîÏ≤≠</button>
            </div>
        </div>
    </div>
    <div class="modal" id="versionModal">
        <div class="modal-content">
            <h2 class="modal-header" style="color:#667eea">üì¶ Î≤ÑÏ†Ñ ÏÑ†ÌÉù</h2>
            <div class="modal-body" id="versionModalBody">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeVersionModal()">Ï∑®ÏÜå</button>
                <button class="btn btn-primary" onclick="confirmVersionDownload()">Îã§Ïö¥Î°úÎìú</button>
            </div>
        </div>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>

    <script>
// IconaMoon-style inline SVGs (https://github.com/dariushhpg1/IconaMoon)
function getIcon(name){
    const commonAttrs='stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"';
    switch(name){
        case 'search': return `<svg viewBox="0 0 24 24" ${commonAttrs}><circle cx="11" cy="11" r="7"></circle><path d="M21 21l-4.3-4.3"></path></svg>`;
        case 'download': return `<svg viewBox="0 0 24 24" ${commonAttrs}><path d="M12 3v12"></path><path d="M7 10l5 5 5-5"></path><path d="M5 21h14"></path></svg>`;
        case 'cart': return `<svg viewBox="0 0 24 24" ${commonAttrs}><path d="M6 6h15l-1.5 9H7.5L6 6z"></path><circle cx="9" cy="20" r="1"></circle><circle cx="18" cy="20" r="1"></circle><path d="M6 6L5 3H3"></path></svg>`;
        case 'info': return `<svg viewBox="0 0 24 24" ${commonAttrs}><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>`;
        case 'logout': return `<svg viewBox="0 0 24 24" ${commonAttrs}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><path d="M16 17l5-5-5-5"></path><path d="M21 12H9"></path></svg>`;
        case 'credit-card': return `<svg viewBox="0 0 24 24" ${commonAttrs}><rect x="2" y="5" width="20" height="14" rx="2"></rect><path d="M2 10h20"></path><path d="M6 15h4"></path></svg>`;
        case 'user': return `<svg viewBox="0 0 24 24" ${commonAttrs}><circle cx="12" cy="8" r="4"></circle><path d="M4 20a8 8 0 0 1 16 0"></path></svg>`;
        case 'sun': return `<svg viewBox="0 0 24 24" ${commonAttrs}><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path></svg>`;
        case 'moon': return `<svg viewBox="0 0 24 24" ${commonAttrs}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
        case 'star': return `<svg viewBox="0 0 24 24" ${commonAttrs}><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></svg>`;
        default: return '';
    }
}
function withIcon(iconName,label){return `<span class="icon">${getIcon(iconName)}</span>${label||''}`}
// Firebase Ï¥àÍ∏∞Ìôî
const firebaseConfig = {
  apiKey: "AIzaSyB_FsD_GqnENdMGeuzH5Q8tICxn_fgu7OQ",
  authDomain: "plugmarketdb.firebaseapp.com",
  databaseURL: "https://plugmarketdb-default-rtdb.firebaseio.com",
  projectId: "plugmarketdb",
  storageBucket: "plugmarketdb.firebasestorage.app",
  messagingSenderId: "142551495005",
  appId: "1:142551495005:web:6b2b02b9ea53b4198138b4",
  measurementId: "G-3YMWZPCFWQ"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const analytics = firebase.analytics();

let plugins={},currentUser=null,currentFilter='all',currentCategory='all',currentSort='popular',selectedRating=0,currentPlugin=null,discordMembers=[],selectedVersion=null,pendingDownloadPlugin=null;
const WEBHOOK='https://discord.com/api/webhooks/1425431420158869584/_H7Fr8vnzydAuqVoQ8Sbm5c2wHlb7EL8XXAIadq1waQGaaPCvJYGjhQotyWU4DHY0-zv';
const CHARGE_WEBHOOK='https://discord.com/api/webhooks/1431904746448621569/lf5VZA1yzetYguDUDCsIJuE0B0K3CQ1TL9Ol-GYDQn5uUGRXQ5XtNGO7FoS6ZVjuwq40';
const DISCORD_CLIENT_ID='1414591036734312499';
const DISCORD_WIDGET_API='https://discord.com/api/guilds/1420030738346152093/widget.json';
const REDIRECT_URI=window.location.origin+window.location.pathname;
const ADMIN_DISCORD_ID='787223885766328340';
const MOJANG_API='https://api.mojang.com/users/profiles/minecraft/';
const initialData={p1:{id:'p1',name:"CookingPlugin",description:"ÏöîÎ¶¨ ÏãúÏä§ÌÖú",version:"1.0",type:"free",category:"Í≤åÏûÑÌîåÎ†àÏù¥",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/uqe6g4wu4vwlfh46qd9i4/CookingPlugin.jar?rlkey=nrxb0beuwyjbxqxq8d9w2oei4&st=sv9nvc3q&dl=1"},p2:{id:'p2',name:"ItemsAdder",description:"Ïª§Ïä§ÌÖÄ ÏïÑÏù¥ÌÖú",version:"1.2",type:"free",category:"Ïª§Ïä§ÌÖÄ",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/jnqiumuvlm9ibos0amapv/itemsadder-1.2-paper.jar?rlkey=37p1s990yx23j2c6b4j3sjpv6&st=u3c9s9qf&dl=1"},p3:{id:'p3',name:"QuestPlugin",description:"ÌÄòÏä§Ìä∏ ÏãúÏä§ÌÖú",version:"1.5",type:"free",category:"RPG",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/j7d7lh2skws90d3hqrwa1/QuestPlugin-1.5-paper.jar?rlkey=9h8n0sr4tyem40jb2bemdok6k&st=31siar1m&dl=1"},p4:{id:'p4',name:"RankPlugin",description:"Îì±Í∏â ÏãúÏä§ÌÖú",version:"1.0",type:"free",category:"ÏãúÏä§ÌÖú",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/o3ig4n0gxrlxuz01j1j7r/rankplugin-1.0-paper.jar?rlkey=t699uhu6eck878a6u6y36f8fq&st=i4gpgqga&dl=1"},p5:{id:'p5',name:"RoulettePlugin",description:"Î£∞Î†õ",version:"1.0",type:"free",category:"Í≤åÏûÑÌîåÎ†àÏù¥",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/fsrnzk9u7vet81euq3afr/RoulettePlugin-1.0-paper.jar?rlkey=yi40cimkve8lim2cg4isr8n6k&st=qbfrlmyz&dl=1"},p6:{id:'p6',name:"ShopSystem",description:"ÏÉÅÏ†ê",version:"1.2",type:"free",category:"Í≤ΩÏ†ú",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/ld31twop0v6v454dhhet0/Shopsystem-1.2-paper.jar?rlkey=we1a2xxv5m25lq1wghj0o1ugf&st=068q0ixb&dl=1"},p7:{id:'p7',name:"SkillSystem",description:"Ïä§ÌÇ¨",version:"1.0",type:"free",category:"RPG",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/8hl3xexcd5h19urq7hg9g/.zip?rlkey=zhdpub1gs0q6y3hspdjr6a3py&st=855e7qb7&dl=1"},p8:{id:'p8',name:"SpectatorOnDeath",description:"Í¥ÄÏ†Ñ",version:"1.0",type:"free",category:"Í≤åÏûÑÌîåÎ†àÏù¥",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/xc2fyqs65nuymhhqwzuc3/SpectatorOnDeath-1.0-paper.jar?rlkey=fwmas7lvqek4ej1atni7gwki5&st=sutonbm3&dl=1"},p9:{id:'p9',name:"SwordPlugin",description:"Í≤Ä",version:"1.2",type:"free",category:"Ïª§Ïä§ÌÖÄ",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/seacbjovms352dw3yyga9/sword-1.2-paper.jar?rlkey=5cdesj2v2ax436ze7905fiifp&st=szgdpnve&dl=1"},p10:{id:'p10',name:"PartyPlugin",description:"ÌååÌã∞ ÌîåÎü¨Í∑∏Ïù∏",version:"1.0",type:"paid",price:1000,category:"Í≤åÏûÑÌîåÎ†àÏù¥",downloads:0,rating:0,reviews:{},downloadUrl:"https://www.dropbox.com/scl/fi/b95odfznqkzds40o6ieov/party_plugin-1.0-paper.jar?rlkey=h2wquxzpyn2ukltkv08onhhbo&st=4duvaelz&dl=1",versions:{'1.21.8':'https://www.dropbox.com/scl/fi/kf8bu05yhhjyeunm2k651/party_plugin1.21.8-1.0-paper.jar?rlkey=s8n4u6qt58kxsx3k50zveiry0&st=f0ztfn93&dl=1','1.21.9':'https://www.dropbox.com/scl/fi/fgn6b55wifynx0phpjfyk/party_plugin1.21.9-1.0-paper.jar?rlkey=3p9sm1zw26ezdbqfdz3ghgk46&st=x3rsm6n3&dl=1','1.21.10':'https://www.dropbox.com/scl/fi/b72g118ghi65l3ffe49km/party_plugin1.21.10-1.0-paper.jar?rlkey=qkd5651rvmb8fc0c4eovd6p0a&st=r25uzg1x&dl=1'}}};

// Firebase Îã§Ïö¥Î°úÎìú Ïπ¥Ïö¥Ìä∏ Î°úÎìú
async function loadDownloadsFromFirebase(){
    try{
        const snapshot = await database.ref('plugins').once('value');
        const firebaseData = snapshot.val();
        if(firebaseData){
            // Firebase Îç∞Ïù¥ÌÑ∞Î°ú Îã§Ïö¥Î°úÎìú Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            let shouldSave = false;
            Object.keys(firebaseData).forEach(pluginId => {
                if(plugins[pluginId]){
                    if(firebaseData[pluginId].downloads !== undefined) {
                        plugins[pluginId].downloads = firebaseData[pluginId].downloads || 0;
                    }
                    if(firebaseData[pluginId].price !== undefined) {
                        plugins[pluginId].price = firebaseData[pluginId].price || 0;
                        shouldSave = true;
                    }
                    if(firebaseData[pluginId].type !== undefined) {
                        plugins[pluginId].type = firebaseData[pluginId].type || 'free';
                        shouldSave = true;
                    }
                }
            });
            if(shouldSave) {
                localStorage.setItem('plugins', JSON.stringify(plugins));
            }
            console.log('‚úÖ FirebaseÏóêÏÑú ÌîåÎü¨Í∑∏Ïù∏ Ï†ïÎ≥¥ Î°úÎìú ÏôÑÎ£å');
        }else{
            // FirebaseÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Ï¥àÍ∏∞Ìôî
            await initializeFirebaseData();
        }
    }catch(e){
        console.log('‚ÑπÔ∏è Firebase ÏÇ¨Ïö© Î∂àÍ∞Ä - localStorageÎßå ÏÇ¨Ïö©Ìï©ÎãàÎã§');
        // Firebase Í≤ΩÍ≥†Î•º Î¨¥ÏãúÌïòÍ≥† localStorageÎßå ÏÇ¨Ïö©
    }
}

// Firebase Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï
async function initializeFirebaseData(){
    try{
        const updates = {};
        Object.keys(plugins).forEach(pluginId => {
            updates[`plugins/${pluginId}`] = {
                name: plugins[pluginId].name,
                downloads: plugins[pluginId].downloads || 0,
                price: plugins[pluginId].price || 0,
                type: plugins[pluginId].type || 'free'
            };
        });
        await database.ref().update(updates);
        console.log('‚úÖ Firebase Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï ÏôÑÎ£å');
    }catch(e){
        console.log('‚ÑπÔ∏è Firebase Ï¥àÍ∏∞Ìôî Î∂àÍ∞Ä - localStorageÎßå ÏÇ¨Ïö©');
    }
}

// FirebaseÏóê Îã§Ïö¥Î°úÎìú Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
async function updateDownloadInFirebase(pluginId){
    try{
        const pluginRef = database.ref(`plugins/${pluginId}/downloads`);
        // Ìä∏ÎûúÏû≠ÏÖòÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏïàÏ†ÑÌïòÍ≤å Ï¶ùÍ∞Ä
        await pluginRef.transaction((currentValue) => {
            return (currentValue || 0) + 1;
        });
        console.log(`‚úÖ Firebase ÏóÖÎç∞Ïù¥Ìä∏: ${pluginId}`);
    }catch(e){
        // Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå® Ïãú Ï°∞Ïö©Ìûà Î¨¥Ïãú
        console.log('‚ÑπÔ∏è Firebase ÏóÖÎç∞Ïù¥Ìä∏ Î∂àÍ∞Ä');
    }
}

// Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
function setupFirebaseListeners(){
    try{
        database.ref('plugins').on('value', (snapshot) => {
            const firebaseData = snapshot.val();
            if(firebaseData && Object.keys(plugins).length > 0){
                let shouldRender = false;
                Object.keys(firebaseData).forEach(pluginId => {
                    if(plugins[pluginId]){
                        const newDownloads = firebaseData[pluginId].downloads;
                        const newPrice = firebaseData[pluginId].price;
                        const newType = firebaseData[pluginId].type;
                        
                        // Í∞íÏù¥ Î≥ÄÍ≤ΩÎêú Í≤ΩÏö∞ÏóêÎßå ÏóÖÎç∞Ïù¥Ìä∏
                        if(plugins[pluginId].downloads !== newDownloads){
                            plugins[pluginId].downloads = newDownloads || 0;
                            shouldRender = true;
                        }
                        if(plugins[pluginId].price !== newPrice && newPrice !== undefined){
                            plugins[pluginId].price = newPrice;
                            shouldRender = true;
                        }
                        if(plugins[pluginId].type !== newType && newType !== undefined){
                            plugins[pluginId].type = newType;
                            shouldRender = true;
                        }
                    }
                });
                
                // Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïù¥ ÏûàÏóàÍ≥† Ï†ÄÏû•Îêú ÌîåÎü¨Í∑∏Ïù∏ Îç∞Ïù¥ÌÑ∞ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                if(shouldRender){
                    saveLocal();
                    if(currentUser){
                        renderPlugins();
                        console.log('‚úÖ FirebaseÏóêÏÑú ÌîåÎü¨Í∑∏Ïù∏ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                    }
                }
            }
        });
    }catch(e){
        console.log('‚ÑπÔ∏è Firebase Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï Î∂àÍ∞Ä');
    }
}

async function loadDiscordMembers(){try{const res=await fetch(DISCORD_WIDGET_API);const data=await res.json();if(data.members){discordMembers=data.members.map(m=>({id:m.id,username:m.username,discriminator:m.discriminator}));console.log('Discord Î©§Î≤Ñ Î°úÎìú:',discordMembers.length+'Î™Ö')}}catch(e){console.error('Discord API Ïã§Ìå®:',e)}}
function loadLocal(){
    const s=localStorage.getItem('plugins');
    if(s){
        try{
            plugins=JSON.parse(s);
            // party_plugin Ìï≠ÏÉÅ ÏµúÏã† ÎßÅÌÅ¨Î°ú ÏóÖÎç∞Ïù¥Ìä∏
            plugins.p10 = {
                id: 'p10',
                name: 'PartyPlugin',
                description: 'ÌååÌã∞ ÌîåÎü¨Í∑∏Ïù∏',
                version: '1.0',
                type: 'paid',
                price: 1000,
                category: 'Í≤åÏûÑÌîåÎ†àÏù¥',
                downloads: plugins.p10?.downloads || 0,
                rating: plugins.p10?.rating || 0,
                reviews: plugins.p10?.reviews || {},
                downloadUrl: 'https://www.dropbox.com/scl/fi/b95odfznqkzds40o6ieov/party_plugin-1.0-paper.jar?rlkey=h2wquxzpyn2ukltkv08onhhbo&st=4duvaelz&dl=1',
                versions: {
                  '1.21.8': 'https://www.dropbox.com/scl/fi/kf8bu05yhhjyeunm2k651/party_plugin1.21.8-1.0-paper.jar?rlkey=s8n4u6qt58kxsx3k50zveiry0&st=x054l1d9&dl=1',
                  '1.21.9': 'https://www.dropbox.com/scl/fi/fgn6b55wifynx0phpjfyk/party_plugin1.21.9-1.0-paper.jar?rlkey=3p9sm1zw26ezdbqfdz3ghgk46&st=e72rdwlw&dl=1',
                  '1.21.10': 'https://www.dropbox.com/scl/fi/b72g118ghi65l3ffe49km/party_plugin1.21.10-1.0-paper.jar?rlkey=qkd5651rvmb8fc0c4eovd6p0a&st=3ezok3i1&dl=1'
                }
            };
            saveLocal();
            // party_plugin Ï°¥Ïû¨ Í≤ÄÏÇ¨ Î∞è Î≥¥Ï†ï
            if(!plugins.p10){
                plugins.p10={
                    id:'p10',
                    name:"PartyPlugin",
                    description:"ÌååÌã∞ ÌîåÎü¨Í∑∏Ïù∏",
                    version:"1.0",
                    type:"paid",
                    price:1000,
                    category:"Í≤åÏûÑÌîåÎ†àÏù¥",
                    downloads:0,
                    rating:0,
                    reviews:{},
                    downloadUrl:"https://www.dropbox.com/scl/fi/b95odfznqkzds40o6ieov/party_plugin-1.0-paper.jar?rlkey=h2wquxzpyn2ukltkv08onhhbo&st=4duvaelz&dl=1",
                    versions:{'1.21.8':'https://www.dropbox.com/scl/fi/kf8bu05yhhjyeunm2k651/party_plugin1.21.8-1.0-paper.jar?rlkey=s8n4u6qt58kxsx3k50zveiry0&st=f0ztfn93&dl=1','1.21.9':'https://www.dropbox.com/scl/fi/fgn6b55wifynx0phpjfyk/party_plugin1.21.9-1.0-paper.jar?rlkey=3p9sm1zw26ezdbqfdz3ghgk46&st=x3rsm6n3&dl=1','1.21.10':'https://www.dropbox.com/scl/fi/b72g118ghi65l3ffe49km/party_plugin1.21.10-1.0-paper.jar?rlkey=qkd5651rvmb8fc0c4eovd6p0a&st=r25uzg1x&dl=1'}
                };
                saveLocal();
                console.log('‚úÖ PartyPlugin added');
            } else {
                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê Í∞ÄÍ≤© ÏóÜÍ±∞ÎÇò 0Ïù¥Î©¥ Í∏∞Î≥∏ Í∞ÄÍ≤© Ï†ÅÏö©
                if((plugins.p10.price||0)===0){
                    plugins.p10.price=1000;
                    plugins.p10.type='paid';
                    saveLocal();
                    console.log('‚úÖ PartyPlugin price updated to 1000');
                }
            }
            // Ensure GuildPlugin exists
            if(!plugins.p11){
                plugins.p11={
                    id:'p11',
                    name:"GuildPlugin",
                    description:"Í∏∏Îìú ÌîåÎü¨Í∑∏Ïù∏",
                    version:"1.2",
                    type:"free",
                    category:"ÏãúÏä§ÌÖú",
                    downloads:0,
                    rating:0,
                    reviews:{},
                    downloadUrl:"https://www.dropbox.com/scl/fi/mbc6cu9ml8k6f2ogdf0xl/guild_plugin-1.2-paper.jar?rlkey=rk09z3l8go7bdrdsowaeacpqm&st=b4wp4vu9&dl=1"
                };
                saveLocal();
                console.log('‚úÖ GuildPlugin added');
            }
            // Ensure FriendPlugin exists
            if(!plugins.p12){
                plugins.p12={
                    id:'p12',
                    name:"FriendPlugin",
                    description:"ÏπúÍµ¨ ÌîåÎü¨Í∑∏Ïù∏",
                    version:"1.1",
                    type:"free",
                    category:"ÏãúÏä§ÌÖú",
                    downloads:0,
                    rating:0,
                    reviews:{},
                    downloadUrl:"https://www.dropbox.com/scl/fi/6tr94vp2peqjns0w0c6ol/firend_plugin-1.1-paper.jar?rlkey=j0vkpwugnhjvla7npy00f9h6e&st=tvmxuubu&dl=1"
                };
                saveLocal();
                console.log('‚úÖ FriendPlugin added');
            }
            console.log('‚úÖ Loaded plugins from localStorage:', Object.keys(plugins).length);
        }catch(e){
            console.error('Error parsing localStorage:', e);
            plugins={...initialData};
            // Add GuildPlugin on fresh init too
            plugins.p11={
                id:'p11',
                name:"GuildPlugin",
                description:"Í∏∏Îìú ÌîåÎü¨Í∑∏Ïù∏",
                version:"1.2",
                type:"free",
                category:"ÏãúÏä§ÌÖú",
                downloads:0,
                rating:0,
                reviews:{},
                downloadUrl:"https://www.dropbox.com/scl/fi/mbc6cu9ml8k6f2ogdf0xl/guild_plugin-1.2-paper.jar?rlkey=rk09z3l8go7bdrdsowaeacpqm&st=b4wp4vu9&dl=1"
            };
            // Add FriendPlugin on fresh init
            plugins.p12={
                id:'p12',
                name:"FriendPlugin",
                description:"ÏπúÍµ¨ ÌîåÎü¨Í∑∏Ïù∏",
                version:"1.1",
                type:"free",
                category:"ÏãúÏä§ÌÖú",
                downloads:0,
                rating:0,
                reviews:{},
                downloadUrl:"https://www.dropbox.com/scl/fi/6tr94vp2peqjns0w0c6ol/firend_plugin-1.1-paper.jar?rlkey=j0vkpwugnhjvla7npy00f9h6e&st=tvmxuubu&dl=1"
            };
            saveLocal();
        }
    }else{
        plugins={...initialData};
        // Add GuildPlugin on first-time init
        plugins.p11={
            id:'p11',
            name:"GuildPlugin",
            description:"Í∏∏Îìú ÌîåÎü¨Í∑∏Ïù∏",
            version:"1.2",
            type:"free",
            category:"ÏãúÏä§ÌÖú",
            downloads:0,
            rating:0,
            reviews:{},
            downloadUrl:"https://www.dropbox.com/scl/fi/mbc6cu9ml8k6f2ogdf0xl/guild_plugin-1.2-paper.jar?rlkey=rk09z3l8go7bdrdsowaeacpqm&st=b4wp4vu9&dl=1"
        };
        // Add FriendPlugin on first-time init
        plugins.p12={
            id:'p12',
            name:"FriendPlugin",
            description:"ÏπúÍµ¨ ÌîåÎü¨Í∑∏Ïù∏",
            version:"1.1",
            type:"free",
            category:"ÏãúÏä§ÌÖú",
            downloads:0,
            rating:0,
            reviews:{},
            downloadUrl:"https://www.dropbox.com/scl/fi/6tr94vp2peqjns0w0c6ol/firend_plugin-1.1-paper.jar?rlkey=j0vkpwugnhjvla7npy00f9h6e&st=tvmxuubu&dl=1"
        };
        saveLocal();
        console.log('‚úÖ Initialized plugins with default data');
    }
}
function saveLocal(){localStorage.setItem('plugins',JSON.stringify(plugins))}
async function sendDiscord(msg){try{await fetch(WEBHOOK,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({embeds:[{title:"üì• ÏïåÎ¶º",description:msg,color:6750054,timestamp:new Date().toISOString()}]})})}catch(e){}}

function requestCharge(){
    if(!currentUser){
        alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
        return;
    }
    
    // ÎßàÏù∏ÌÅ¨ÎûòÌîÑÌä∏ ÎãâÎÑ§ÏûÑÏùÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï
    const mcName = currentUser.actualMcName || currentUser.username || '';
    document.getElementById('chargeName').value = mcName;
    document.getElementById('chargeAmount').value = '';
    document.getElementById('chargeModal').classList.add('active');
}

function closeChargeModal(){
    document.getElementById('chargeModal').classList.remove('active');
}

async function submitChargeRequest(){
    const name = document.getElementById('chargeName').value.trim();
    const amount = document.getElementById('chargeAmount').value.trim();
    
    if(!name){
        alert('ÏûÖÍ∏à Ïãú ÏÇ¨Ïö©Ìï† Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
    }
    
    if(!amount || parseInt(amount) <= 0){
        alert('Ï∂©Ï†Ñ Í∏àÏï°ÏùÑ Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
    }
    
    const mcName = currentUser.actualMcName || currentUser.username || 'Unknown';
    
    try{
        const response = await fetch(CHARGE_WEBHOOK,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                embeds:[{
                    title:"üí∞ Ï∂©Ï†Ñ ÏöîÏ≤≠",
                    description:`**ÎßàÏù∏ÌÅ¨ÎûòÌîÑÌä∏ ÎãâÎÑ§ÏûÑ:** ${mcName}\n**ÏûÖÍ∏à Ïù¥Î¶Ñ:** ${name}\n**Ï∂©Ï†Ñ Í∏àÏï°:** ${parseInt(amount).toLocaleString()}Ïõê\n**ÏöîÏ≤≠ ÏãúÍ∞Ñ:** ${new Date().toLocaleString('ko-KR')}\n\nüí≥ **ÏûÖÍ∏à Í≥ÑÏ¢å**\nÍµ≠ÎØºÏùÄÌñâ: 7018-9074-0985-68`,
                    color:3447003,
                    timestamp:new Date().toISOString()
                }]
            })
        });
        
        if(response.ok){
            alert('‚úÖ Ï∂©Ï†Ñ ÏöîÏ≤≠Ïù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§!\n\nüí≥ ÏûÖÍ∏à ÌõÑ Í¥ÄÎ¶¨ÏûêÍ∞Ä ÏûîÏï°ÏùÑ Ï∂©Ï†ÑÌï¥ÎìúÎ¶ΩÎãàÎã§.');
            closeChargeModal();
        }else{
            alert('‚ùå ÏöîÏ≤≠ Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
        }
    }catch(e){
        console.error('Ï∂©Ï†Ñ ÏöîÏ≤≠ Ïã§Ìå®:', e);
        alert('‚ùå ÏöîÏ≤≠ Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    }
}

async function init(){
    loadLocal();
    loadDiscordMembers();
    setupListeners();
    
    // OAuth ÏΩúÎ∞± Ï≤òÎ¶¨
    handleOAuthCallback();
    
    // FirebaseÏóêÏÑú Îã§Ïö¥Î°úÎìú Ïπ¥Ïö¥Ìä∏ Î°úÎìú Î∞è Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî ÏãúÏûë
    await loadDownloadsFromFirebase();
    setupFirebaseListeners();
    
    // currentUserÍ∞Ä ÏûàÏúºÎ©¥ (OAuth ÏΩúÎ∞±ÏóêÏÑú ÏÑ§Ï†ïÎêòÍ±∞ÎÇò localStorageÏóê Ï†ÄÏû•Îêú Í≤ΩÏö∞)
    if(currentUser && currentUser.minecraftId){
        // ÏûîÏï° Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
        updateUserBalance();
        showUserInfo();
        renderPlugins();
    }else{
        // localStorageÏóê Ï†ÄÏû•Îêú ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûàÏúºÎ©¥ Î°úÎìú
        const u=localStorage.getItem('currentUser');
        if(u){
            try {
                currentUser=JSON.parse(u);
                console.log('‚úÖ Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê Î°úÎìú:', currentUser.minecraftId);
                // ÏûîÏï° Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
                updateUserBalance();
                showUserInfo();
                renderPlugins();
            } catch(e) {
                console.error('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:', e);
                // Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÜêÏÉÅÎêòÏóàÏúºÎ©¥ ÏÇ≠Ï†úÌïòÍ≥† Ïû¨Î°úÍ∑∏Ïù∏
                localStorage.removeItem('currentUser');
                window.location.href='login.html';
            }
        }else{
            console.log('‚ùå Î°úÍ∑∏Ïù∏ ÌïÑÏöî');
            window.location.href='login.html';
        }
    }
}

async function handleOAuthCallback(){
    const params=new URLSearchParams(window.location.search);
    const code=params.get('code');
    if(code){
        const state=params.get('state');
        let minecraftId = 'Player' + Math.floor(Math.random() * 9999);
        let discordId = localStorage.getItem('discordId') || '';
        let discordUsername = '';
        
        // StateÏóêÏÑú Îç∞Ïù¥ÌÑ∞ ÌååÏã±
        if(state) {
            try {
                const stateData = JSON.parse(decodeURIComponent(state));
                minecraftId = stateData.minecraftId || minecraftId;
            } catch(e) {
                minecraftId = decodeURIComponent(state);
            }
        }
        
        console.log('‚úÖ Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥:', {minecraftId, discordId});
        
        // Minecraft Ïã§Ï†ú ÎãâÎÑ§ÏûÑ Í∞ÄÏ†∏Ïò§Í∏∞
        let actualMcName = minecraftId;
        try {
            const mcResponse = await fetch(MOJANG_API + minecraftId);
            if(mcResponse.ok) {
                const mcData = await mcResponse.json();
                actualMcName = mcData.name;
            }
        } catch(e) {
            console.log('Minecraft API Ìò∏Ï∂ú Ïã§Ìå®, ÏûÖÎ†•Í∞í ÏÇ¨Ïö©');
        }
        
        currentUser={
            discordCode:code,
            discordId:discordId,
            discordUsername:discordUsername,
            minecraftId:minecraftId,
            actualMcName:actualMcName,
            username:actualMcName,
            loginTime:new Date().toISOString(),
            downloads:[],
            reviews:{}
        };
        
        // Discord IDÍ∞Ä ÏóÜÏúºÎ©¥ Ï†ÄÏû• (ÏûàÏúºÎ©¥ Ïù¥ÎØ∏ Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏùå)
        if(!localStorage.getItem('discordId') && discordId) {
            localStorage.setItem('discordId', discordId);
        }
        
        // Ïú†Ï†Ä Ï†ïÎ≥¥Î•º Ï†ÑÏ≤¥ Ïú†Ï†Ä Î™©Î°ùÏóê Ï†ÄÏû•
        const allUsers = JSON.parse(localStorage.getItem('allUsers') || '{}');
        if(!allUsers[minecraftId]) {
            allUsers[minecraftId] = {
                minecraftId: minecraftId,
                actualMcName: actualMcName,
                discordId: discordId,
                discordUsername: discordUsername,
                balance: 0,
                lastLogin: new Date().toISOString()
            };
        } else {
            allUsers[minecraftId].lastLogin = new Date().toISOString();
            allUsers[minecraftId].actualMcName = actualMcName;
            allUsers[minecraftId].discordId = discordId; // Discord ID ÏóÖÎç∞Ïù¥Ìä∏
        }
        localStorage.setItem('allUsers', JSON.stringify(allUsers));
        
        // currentUser Ï†ÄÏû• - Îã§Ïùå Î≤àÏóê ÏûêÎèô Î°úÍ∑∏Ïù∏
        localStorage.setItem('currentUser',JSON.stringify(currentUser));
        
        // URLÏóêÏÑú code Ï†úÍ±∞
        window.history.replaceState({},document.title,window.location.pathname);
        
        showUserInfo();
        renderPlugins();
        
        console.log('‚úÖ Î°úÍ∑∏Ïù∏ ÏôÑÎ£å:', currentUser);
        
        // ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÎßå Î°úÍ∑∏ ÎÇ®Í∏∞Í∏∞ (Í¥ÄÎ¶¨ÏûêÎäî Î°úÍ∑∏ Ï†úÏô∏)
        if(discordId !== ADMIN_DISCORD_ID && discordId) {
            sendDiscord(`**‚úÖ Î°úÍ∑∏Ïù∏**\n**ÎßàÏù∏ÌÅ¨ÎûòÌîÑÌä∏:** ${actualMcName}\n**ÏãúÍ∞Ñ:** ${new Date().toLocaleString('ko-KR')}`);
        }
    }
}

function showUserInfo(){
    const displayName = currentUser.actualMcName || currentUser.username || 'User';
    document.getElementById('userName').textContent=displayName+'Îãò';
    document.getElementById('userIdDisplay').textContent='MC: '+displayName;
    updateUserStats();
    updateUserBalance();
    
    // Í¥ÄÎ¶¨Ïûê Î≤ÑÌäº Ï∂îÍ∞Ä (Í¥ÄÎ¶¨ÏûêÏù∏ Í≤ΩÏö∞)
    const isAdmin = checkAdmin();
    if(isAdmin && !document.getElementById('adminBtn')) {
        const adminBtn = document.createElement('button');
        adminBtn.id = 'adminBtn';
        adminBtn.className = 'btn-logout';
        adminBtn.style.marginTop = '10px';
        adminBtn.textContent = '‚öôÔ∏è Í¥ÄÎ¶¨ Ìà¥';
        adminBtn.onclick = () => window.location.href = 'admin.html';
        document.querySelector('.user-info').appendChild(adminBtn);
    }
    // Ìó§Îçî Î≤ÑÌäº ÏïÑÏù¥ÏΩò Ï†ÅÏö©
    const btnCharge=document.getElementById('btnCharge');
    const btnMyPage=document.getElementById('btnMyPage');
    const btnLogout=document.getElementById('btnLogout');
    if(btnCharge) btnCharge.innerHTML=withIcon('credit-card','Ï∂©Ï†Ñ ÏöîÏ≤≠');
    if(btnMyPage) btnMyPage.innerHTML=withIcon('user','ÎßàÏù¥ÌéòÏù¥ÏßÄ');
    if(btnLogout) btnLogout.innerHTML=withIcon('logout','Î°úÍ∑∏ÏïÑÏõÉ');
}

function updateUserBalance(){
    if(!currentUser) return;
    const allUsers = JSON.parse(localStorage.getItem('allUsers') || '{}');
    const userBalance = allUsers[currentUser.minecraftId]?.balance || 0;
    const balanceElement = document.getElementById('userBalance');
    if(balanceElement) {
        balanceElement.textContent = userBalance.toLocaleString();
    }
}

function checkAdmin(){
    // Discord IDÎ°ú Í¥ÄÎ¶¨Ïûê Ï≤¥ÌÅ¨ (ÌòÑÏû¨Îäî Í∞ÑÎã®Ìïú Íµ¨ÌòÑ)
    // Ïã§Ï†úÎ°úÎäî Discord APIÎ°ú ÌôïÏù∏Ìï¥Ïïº Ìï®
    return currentUser && currentUser.discordId === ADMIN_DISCORD_ID;
}

function setupListeners(){
    document.querySelectorAll('.category-tag').forEach(t=>t.addEventListener('click',function(){document.querySelectorAll('.category-tag').forEach(x=>x.classList.remove('active'));this.classList.add('active');currentCategory=this.dataset.category;renderPlugins()}));
    document.querySelectorAll('.filter-btn').forEach(b=>b.addEventListener('click',function(){document.querySelectorAll('.filter-btn').forEach(x=>x.classList.remove('active'));this.classList.add('active');currentFilter=this.dataset.filter;renderPlugins()}));
    document.getElementById('sortSelect').addEventListener('change',function(){currentSort=this.value;renderPlugins()});
    document.getElementById('searchInput').addEventListener('keypress',function(e){if(e.key==='Enter')searchPlugins()});
    document.querySelectorAll('#starRating .star').forEach(s=>s.addEventListener('click',function(){selectedRating=parseInt(this.dataset.rating);document.querySelectorAll('#starRating .star').forEach((x,i)=>{if(i<selectedRating)x.classList.add('active');else x.classList.remove('active')})}));
}

function setupPluginCardListeners(){
    document.querySelectorAll('.btn[data-action="download"]').forEach(btn=>{
        btn.addEventListener('click',function(e){
            e.preventDefault();
            e.stopPropagation();
            const pluginId=this.dataset.pluginId;
            downloadPlugin(pluginId);
        });
    });
    document.querySelectorAll('.btn[data-action="detail"]').forEach(btn=>{
        btn.addEventListener('click',function(e){
            e.preventDefault();
            e.stopPropagation();
            const pluginId=this.dataset.pluginId;
            showDetail(pluginId);
        });
    });
}

window.logout=function(){
    if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')){
        currentUser=null;
        localStorage.removeItem('currentUser');
        window.location.href='login.html';
    }
};

function updateUserStats(){
    if(!currentUser)return;
    const d=currentUser.downloads?currentUser.downloads.length:0;
    const r=currentUser.reviews?Object.values(currentUser.reviews):[];
    const a=r.length>0?(r.reduce((s,x)=>s+x.rating,0)/r.length).toFixed(1):'0.0';
    document.getElementById('downloadCount').textContent=d;
    document.getElementById('avgRating').textContent=a;
}

function renderPlugins(){
    const g=document.getElementById('pluginsGrid');
    if(!g) return;
    let l=Object.values(plugins);
    if(!l || l.length === 0){
        console.log('No plugins to render');
        return;
    }
    if(currentCategory!=='all')l=l.filter(p=>p.category===currentCategory);
    if(currentFilter==='free')l=l.filter(p=>p.type==='free');
    else if(currentFilter==='premium')l=l.filter(p=>p.type==='paid'&&(p.price||0)>0);
    else if(currentFilter==='downloaded'&&currentUser)l=l.filter(p=>currentUser.downloads&&currentUser.downloads.some(d=>d.pluginId===p.id));
    const t=document.getElementById('searchInput').value.toLowerCase();
    if(t)l=l.filter(p=>p.name.toLowerCase().includes(t));
    l.sort((a,b)=>{if(currentSort==='rating')return(b.rating||0)-(a.rating||0);if(currentSort==='downloads')return b.downloads-a.downloads;return(b.downloads*(b.rating||0))-(a.downloads*(a.rating||0))});
    g.innerHTML=l.map(p=>{
        const i=currentUser&&currentUser.downloads&&currentUser.downloads.some(d=>d.pluginId===p.id);
        const c=p.reviews?Object.keys(p.reviews).length:0;
        const s='‚òÖ'.repeat(Math.round(p.rating||0))+'‚òÜ'.repeat(5-Math.round(p.rating||0));
        const isFree=p.type==='free'||(p.price||0)===0;
        const badgeText=isFree?'Î¨¥Î£å':`${(p.price||0).toLocaleString()}Ïõê`;
        const badgeColor=isFree?'#10b981':'#f59e0b';
        const versionInfo = (p.versions && Object.keys(p.versions).length > 0) ? `<p class="plugin-version">v${p.version} ‚Ä¢ ${Object.keys(p.versions).length}Í∞ú ÎßàÏù∏ÌÅ¨ÎûòÌîÑÌä∏ Î≤ÑÏ†Ñ ÏßÄÏõê</p>` : `<p class="plugin-version">v${p.version}</p>`;
        return`<div class="plugin-card"><div style="display:flex;justify-content:space-between"><div><h3 class="plugin-title">${p.name}</h3><span class="plugin-category">${p.category}</span></div><span class="plugin-badge" style="background:${badgeColor}">${badgeText}</span></div><p class="plugin-description">${p.description}</p>${versionInfo}<div class="plugin-rating"><span class="stars">${s}</span><span class="rating-count">${(p.rating||0).toFixed(1)}(${c})</span></div><p class="plugin-downloads">${withIcon('download',`${p.downloads}Ìöå`)}</p>${i?'<div style="background:#10b981;color:white;padding:8px;border-radius:8px;text-align:center;margin:10px 0">‚úì Îã§Ïö¥Î°úÎìú ÏôÑÎ£å</div>':''}<div class="plugin-footer"><button class="btn btn-primary" data-plugin-id="${p.id}" data-action="download">${withIcon(isFree?'download':'cart', i?'Ïû¨Îã§Ïö¥':isFree?'Îã§Ïö¥Î°úÎìú':'Íµ¨Îß§')}</button><button class="btn btn-secondary" data-plugin-id="${p.id}" data-action="detail">${withIcon('info','ÏÉÅÏÑ∏Î≥¥Í∏∞')}</button></div></div>`
    }).join('');
    setupPluginCardListeners();
}

window.searchPlugins=function(){renderPlugins()};

window.showDetail=function(pid){
    currentPlugin=plugins[pid];
    if(!currentPlugin)return;
    const i=currentUser&&currentUser.downloads&&currentUser.downloads.some(d=>d.pluginId===pid);
    const u=currentUser&&currentUser.reviews&&currentUser.reviews[pid];
    document.getElementById('modalTitle').textContent=currentPlugin.name;
    
    // Î¶¨Î∑∞ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
    let r=currentPlugin.reviews||{};
    if(!r || typeof r !== 'object'){
        r={};
    }
    
    const rKeys=Object.keys(r);
    console.log('Î¶¨Î∑∞ Îç∞Ïù¥ÌÑ∞:', r, 'ÌÇ§ Í∞úÏàò:', rKeys.length);
    
    let h='<div class="reviews-section"><h3>üìù Î¶¨Î∑∞('+rKeys.length+')</h3>';
    if(rKeys.length===0){
        h+='<p style="text-align:center;color:var(--text-tertiary);padding:20px">ÏïÑÏßÅ Î¶¨Î∑∞Í∞Ä ÏóÜÏäµÎãàÎã§</p>';
    }else{
        rKeys.forEach(key=>{
            const x=r[key];
            if(!x)return;
            
            const isMyReview=currentUser&&key===currentUser.minecraftId;
            const s='‚òÖ'.repeat(Math.floor(x.rating||0))+'‚òÜ'.repeat(5-Math.floor(x.rating||0));
            const deleteBtn=isMyReview?`<button onclick="deleteReview('${pid}','${key}')" style="background:#ef4444;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:0.85em">üóëÔ∏è ÏÇ≠Ï†ú</button>`:'';
            h+=`<div class="review-item" id="review-${key}"><div class="review-header" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px"><div><span class="review-author">${x.author||'ÏùµÎ™Ö'}</span><span class="stars">${s}</span></div>${deleteBtn}</div><p class="review-text">${x.text||''}</p><span class="review-date">${x.date||''}</span></div>`;
        });
    }
    h+='</div>';
    const rating=currentPlugin.rating||0;
    const priceInfo=currentPlugin.type==='free'?'Î¨¥Î£å':`${(currentPlugin.price||0).toLocaleString()}Ïõê`;
    
    // Î≤ÑÏ†Ñ ÏÑ†ÌÉù UI Ï†úÍ±∞ (ÎßàÏù¥ÌéòÏù¥ÏßÄÏóêÏÑúÎßå Î≤ÑÏ†Ñ ÏÑ†ÌÉù)
    let versionSelector = '';
    
    document.getElementById('modalBody').innerHTML=`<p><strong>Ïπ¥ÌÖåÍ≥†Î¶¨:</strong> ${currentPlugin.category}</p><p><strong>ÌÉÄÏûÖ:</strong> ${currentPlugin.type==='free'?'Î¨¥Î£å':'Ïú†Î£å'}</p><p><strong>Í∞ÄÍ≤©:</strong> ${priceInfo}</p><p><strong>Î≤ÑÏ†Ñ:</strong> v${currentPlugin.version}</p><p><strong>ÌèâÏ†ê:</strong> ${rating.toFixed(1)}/5.0</p><p><strong>Îã§Ïö¥Î°úÎìú:</strong> ${currentPlugin.downloads}Ìöå</p><p style="margin-top:15px">${currentPlugin.description}</p>${versionSelector}${h}`;
    const b=document.getElementById('modalAction');
    if(i){b.innerHTML=withIcon('star',u?'Î¶¨Î∑∞ ÏàòÏ†ï':'Î¶¨Î∑∞ ÏûëÏÑ±');b.onclick=()=>openReviewModal(pid)}else{b.innerHTML=withIcon(currentPlugin.type==='free'?'download':'cart',currentPlugin.type==='free'?'Îã§Ïö¥Î°úÎìú':'Íµ¨Îß§');b.onclick=()=>downloadPlugin(pid)}
    document.getElementById('detailModal').classList.add('active');
};

window.closeDetailModal=function(){document.getElementById('detailModal').classList.remove('active')};

window.downloadPlugin=async function(pid,forceDownload){
    if(!currentUser){if(confirm('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§. Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?')){window.location.href='login.html'}return}
    const p=plugins[pid];if(!p)return;
    
    // Î≤ÑÏ†Ñ Î™®Îã¨ ÏÇ¨Ïö© Ïïà Ìï®: Ïñ∏Ï†úÎÇò Ïã§Ìñâ Í≤ΩÎ°úÎ°ú ÏßÑÌñâ
    await executeDownload(pid);
};

async function executeDownload(pid){
    const p=plugins[pid];if(!p){alert('ÌîåÎü¨Í∑∏Ïù∏ Ï†ïÎ≥¥ ÏóÜÏùå!');return;}
    const isPaid=p.type==='paid'&&(p.price||0)>0;
    const alreadyPurchased=currentUser && currentUser.downloads && currentUser.downloads.some(d=>d.pluginId===pid);
    // PartyPlugin(Î≤ÑÏ†Ñ ÏûàÎäî ÌîåÎü¨Í∑∏Ïù∏) ÌäπÎ≥Ñ Ï≤òÎ¶¨: Íµ¨Îß§Îßå ÌïòÍ≥† ÎßàÏù¥ÌéòÏù¥ÏßÄÏóêÏÑú Î≤ÑÏ†Ñ Îã§Ïö¥Î°úÎìú
    if(p.id==='p10'){
        if(!alreadyPurchased){
            const allUsers=JSON.parse(localStorage.getItem('allUsers')||'{}');
            const userBalance=allUsers[currentUser.minecraftId]?.balance||0;
            const price=p.price||0;
            if(userBalance<price){alert('‚ùå ÏûîÏï°Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§!');return;}
            if(!confirm(`${p.name}ÏùÑ(Î•º) ${price.toLocaleString()}ÏõêÏóê Íµ¨Îß§ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÎÇ®ÏùÄ ÏûîÏï°: ${(userBalance-price).toLocaleString()}Ïõê`)){return;}
            allUsers[currentUser.minecraftId].balance=userBalance-price;
            localStorage.setItem('allUsers',JSON.stringify(allUsers));
            updateUserBalance();
        }
        await updateDownloadInFirebase(pid);
        p.downloads++;
        const rec={pluginId:p.id,pluginName:p.name,date:new Date().toLocaleString('ko-KR')};
        if(!currentUser.downloads)currentUser.downloads=[];
        if(!currentUser.downloads.some(d=>d.pluginId===pid))currentUser.downloads.push(rec);
        saveLocal();
        localStorage.setItem('currentUser',JSON.stringify(currentUser));
        renderPlugins();
        selectedVersion=null;
        alert('Íµ¨Îß§ ÏôÑÎ£å! ÎßàÏù¥ÌéòÏù¥ÏßÄÏóêÏÑú Î≤ÑÏ†ÑÎ≥ÑÎ°ú Îã§Ïö¥Î°úÎìú ÌïòÏÑ∏Ïöî.');
        return;
    }
    // ÏùºÎ∞ò Ïú†Î£å ÌîåÎü¨Í∑∏Ïù∏: Ï≤òÏùå Íµ¨Îß§ Ïãú ÏûîÏï° Ï∞®Í∞ê ÌõÑ Ï¶âÏãú Îã§Ïö¥Î°úÎìú
    if(isPaid && !alreadyPurchased){
        const allUsers=JSON.parse(localStorage.getItem('allUsers')||'{}');
        const userBalance=allUsers[currentUser.minecraftId]?.balance||0;
        const price=p.price||0;
        if(userBalance<price){alert('‚ùå ÏûîÏï°Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§!');return;}
        if(!confirm(`${p.name}ÏùÑ(Î•º) ${price.toLocaleString()}ÏõêÏóê Íµ¨Îß§ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÎÇ®ÏùÄ ÏûîÏï°: ${(userBalance-price).toLocaleString()}Ïõê`)){return;}
        allUsers[currentUser.minecraftId].balance=userBalance-price;
        localStorage.setItem('allUsers',JSON.stringify(allUsers));
        updateUserBalance();
    }
    // Îã§Ïö¥Î°úÎìú Ï≤òÎ¶¨
    // FirebaseÏóê Îã§Ïö¥Î°úÎìú Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
    await updateDownloadInFirebase(pid);
    p.downloads++;
    const rec={pluginId:p.id,pluginName:p.name,date:new Date().toLocaleString('ko-KR')};
    if(!currentUser.downloads)currentUser.downloads=[];
    if(!currentUser.downloads.some(d=>d.pluginId===pid))currentUser.downloads.push(rec);
    saveLocal();
    let downloadUrl = p.downloadUrl;
    if(selectedVersion && p.versions && p.versions[selectedVersion]) downloadUrl = p.versions[selectedVersion];
    window.open(downloadUrl, '_blank');
    localStorage.setItem('currentUser',JSON.stringify(currentUser));
    renderPlugins();
    selectedVersion = null;
}

// Î≤ÑÏ†Ñ Î™®Îã¨ÏùÄ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå (ÎßàÏù¥ÌéòÏù¥ÏßÄÏóêÏÑúÎßå Î≤ÑÏ†Ñ ÏÑ†ÌÉù)
window.showVersionModal=function(){alert('Î≤ÑÏ†Ñ ÏÑ†ÌÉùÏùÄ ÎßàÏù¥ÌéòÏù¥ÏßÄÏóêÏÑúÎßå Í∞ÄÎä•Ìï©ÎãàÎã§.');};
window.closeVersionModal=function(){};
window.confirmVersionDownload=function(){};

window.openReviewModal=function(pid){
    currentPlugin=plugins[pid];
    const isDownloaded=currentUser&&currentUser.downloads&&currentUser.downloads.some(d=>d.pluginId===pid);
    if(!isDownloaded){
        alert('‚ùå Î¶¨Î∑∞Îäî Îã§Ïö¥Î°úÎìúÌïú ÌîåÎü¨Í∑∏Ïù∏Îßå ÏûëÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§!');
        return;
    }
    const u=currentUser.reviews&&currentUser.reviews[pid];
    if(u){selectedRating=u.rating;document.getElementById('reviewText').value=u.text;document.querySelectorAll('#starRating .star').forEach((s,i)=>{if(i<selectedRating)s.classList.add('active');else s.classList.remove('active')})}else{selectedRating=0;document.getElementById('reviewText').value='';document.querySelectorAll('#starRating .star').forEach(s=>s.classList.remove('active'))}
    closeDetailModal();document.getElementById('reviewModal').classList.add('active');
};

window.closeReviewModal=function(){document.getElementById('reviewModal').classList.remove('active')};

window.submitReview=async function(){
    if(!currentUser||!currentPlugin)return;
    const isDownloaded=currentUser.downloads&&currentUser.downloads.some(d=>d.pluginId===currentPlugin.id);
    if(!isDownloaded){
        alert('‚ùå Î¶¨Î∑∞Îäî Îã§Ïö¥Î°úÎìúÌïú ÌîåÎü¨Í∑∏Ïù∏Îßå ÏûëÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§!');
        closeReviewModal();
        return;
    }
    if(selectedRating===0){alert('Î≥ÑÏ†êÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî');return}
    const t=document.getElementById('reviewText').value.trim();
    if(!t){alert('Î¶¨Î∑∞ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');return}
    const authorName=currentUser.actualMcName||currentUser.username||'ÏùµÎ™Ö';
    const r={author:authorName,rating:selectedRating,text:t,date:new Date().toLocaleString('ko-KR')};
    if(!currentPlugin.reviews)currentPlugin.reviews={};
    currentPlugin.reviews[currentUser.minecraftId]=r;
    const v=Object.values(currentPlugin.reviews);
    const a=v.reduce((s,x)=>s+x.rating,0)/v.length;
    currentPlugin.rating=Math.round(a*10)/10;
    if(!currentUser.reviews)currentUser.reviews={};
    currentUser.reviews[currentPlugin.id]=r;
    saveLocal();
    localStorage.setItem('currentUser',JSON.stringify(currentUser));
    closeReviewModal();
    closeDetailModal();
    alert('Î¶¨Î∑∞Í∞Ä Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!');
    // Î¶¨Î∑∞ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
    setTimeout(()=>{
        showDetail(currentPlugin.id);
    },100);
    // ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê Î¶¨Î∑∞ ÏõπÌõÖ Ï†úÍ±∞ (Í¥ÄÎ¶¨ÏûêÎßå Î°úÍ∑∏)
};

window.deleteReview=function(pid,reviewKey){
    if(!confirm('Î¶¨Î∑∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?'))return;
    const plugin=plugins[pid];
    if(!plugin||!plugin.reviews)return;
    
    // Î¶¨Î∑∞ ÏÇ≠Ï†ú
    delete plugin.reviews[reviewKey];
    
    // ÏÇ¨Ïö©ÏûêÏùò Î¶¨Î∑∞ÎèÑ ÏÇ≠Ï†ú
    if(currentUser.reviews&&currentUser.reviews[pid]){
        delete currentUser.reviews[pid];
    }
    
    // ÌèâÏ†ê Ïû¨Í≥ÑÏÇ∞
    const v=Object.values(plugin.reviews);
    if(v.length===0){
        plugin.rating=0;
    }else{
        const a=v.reduce((s,x)=>s+x.rating,0)/v.length;
        plugin.rating=Math.round(a*10)/10;
    }
    
    saveLocal();
    localStorage.setItem('currentUser',JSON.stringify(currentUser));
    
    // Î™®Îã¨ Îã´Í≥† Îã§Ïãú Ïó¥Í∏∞
    closeDetailModal();
    setTimeout(()=>{
        showDetail(pid);
    },100);
    alert('Î¶¨Î∑∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§!');
};

window.showHistory=function(){
    if(!currentUser)return;
    const b=document.getElementById('historyBody');
    const d=currentUser.downloads||[];
    
    if(d.length===0){
        b.innerHTML='<p style="text-align:center;color:#999;padding:40px">Îã§Ïö¥Î°úÎìú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§<br><br>üí° ÏÉÅÎã®ÏóêÏÑú ÌîåÎü¨Í∑∏Ïù∏ÏùÑ Îã§Ïö¥Î°úÎìúÌï¥Î≥¥ÏÑ∏Ïöî!</p>';
    }else{
        b.innerHTML=d.map(x=>{
            const plugin=plugins[x.pluginId];
            const pluginDesc=plugin?plugin.description:'ÌîåÎü¨Í∑∏Ïù∏ Ï†ïÎ≥¥ ÏóÜÏùå';
            const pluginVer=plugin?`v${plugin.version}`:'';
            const pluginType=plugin&&plugin.type==='paid'?`üí∞ ${(plugin.price||0).toLocaleString()}Ïõê Íµ¨Îß§`:'üéÅ Î¨¥Î£å Îã§Ïö¥Î°úÎìú';
            // party pluginÎßå Î≤ÑÏ†ÑÏÑ†ÌÉù
            if(plugin && plugin.id==='p10' && plugin.versions){
              const versionSelectId='redownloadVersion_p10'; // Í≥†Ïú† id(ÌïúÎ™ÖÎßå ÎÇ¥Ïó≠ ÏÉùÏÑ±Îê®)
              return`
                <div class="history-item" style="display:flex;justify-content:space-between;align-items:center;gap:15px;flex-wrap:wrap">
                  <div style="flex:1;min-width:200px">
                      <h3 style="margin-bottom:8px;color:var(--text-primary)">${x.pluginName}</h3>
                      <p style="color:var(--text-secondary);font-size:0.9em;margin-bottom:5px">${pluginDesc}</p>
                      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
                          <span style="background:var(--tag-bg);padding:4px 10px;border-radius:10px;font-size:0.85em;color:var(--text-secondary)">${pluginVer}</span>
                          <span style="background:#10b981;color:white;padding:4px 10px;border-radius:10px;font-size:0.85em">${pluginType}</span>
                      </div>
                      <p style="color:var(--text-tertiary);font-size:0.85em;margin-top:8px">üìÖ ${x.date}</p>
                      <div style="margin-top:13px">  
                        <select id="${versionSelectId}" style="padding:7px;border-radius:7px;margin-right:9px;">
                          <option value="">Í∏∞Î≥∏</option>
                          ${Object.keys(plugin.versions).map(v=>`<option value="${v}">${v}</option>`).join('')}
                        </select>
                        <button class="btn btn-primary" onclick="reDownloadVersion('p10')">üì• Î≤ÑÏ†ÑÎ≥Ñ Îã§Ïö¥Î°úÎìú</button>
                      </div>
                  </div>
                </div>`;
            }
            // ÎÇòÎ®∏ÏßÄ ÏùºÎ∞ò ÌîåÎü¨Í∑∏Ïù∏ ÎÇ¥Ïó≠
            return`
            <div class="history-item" style="display:flex;justify-content:space-between;align-items:center;gap:15px;flex-wrap:wrap">
                <div style="flex:1;min-width:200px">
                    <h3 style="margin-bottom:8px;color:var(--text-primary)">${x.pluginName}</h3>
                    <p style="color:var(--text-secondary);font-size:0.9em;margin-bottom:5px">${pluginDesc}</p>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
                        <span style="background:var(--tag-bg);padding:4px 10px;border-radius:10px;font-size:0.85em;color:var(--text-secondary)">${pluginVer}</span>
                        <span style="background:#10b981;color:white;padding:4px 10px;border-radius:10px;font-size:0.85em">${pluginType}</span>
                    </div>
                    <p style="color:var(--text-tertiary);font-size:0.85em;margin-top:8px">üìÖ ${x.date}</p>
                </div>
                <button class="btn btn-primary" onclick="reDownloadPlugin('${x.pluginId}')" style="padding:12px 24px;white-space:nowrap">${withIcon('download','Îã§Ïãú Îã§Ïö¥Î°úÎìú')}</button>
            </div>`;
        }).join('');
    }
    
    document.getElementById('historyModal').classList.add('active');
};

window.reDownloadVersion=function(pluginId){
    const plugin = plugins[pluginId];
    if(!plugin) { alert('ÌîåÎü¨Í∑∏Ïù∏ Ï†ïÎ≥¥ ÏóÜÏùå!'); return; }
    let downloadUrl = plugin.downloadUrl;
    // party ÌîåÎü¨Í∑∏Ïù∏ÏùÄ Î¨¥Ï°∞Í±¥ Î≤ÑÏ†Ñ ÎìúÎ°≠Îã§Ïö¥ Ï°¥Ïû¨
    const select = document.getElementById('redownloadVersion_p10');
    const version = select? select.value : '';
    if(version && plugin.versions && plugin.versions[version]){
        downloadUrl = plugin.versions[version];
    }
    window.open(downloadUrl, '_blank');
};

window.reDownloadPlugin=function(pluginId){
    closeHistoryModal();
    downloadPlugin(pluginId);
};

window.closeHistoryModal=function(){document.getElementById('historyModal').classList.remove('active')};

function toggleTheme(){
    const body=document.body;
    const isDark=body.classList.toggle('dark-mode');
    localStorage.setItem('theme',isDark?'dark':'light');
    updateThemeIcon();
}

function updateThemeIcon(){
    const toggle=document.querySelector('.theme-toggle');
    if(document.body.classList.contains('dark-mode')){
        toggle.innerHTML=withIcon('sun','');
    }else{
        toggle.innerHTML=withIcon('moon','');
    }
}

function loadTheme(){
    const savedTheme=localStorage.getItem('theme');
    if(savedTheme==='dark'){
        document.body.classList.add('dark-mode');
    }
    updateThemeIcon();
}

document.addEventListener('DOMContentLoaded',()=>{
    loadTheme();
    const searchBtn=document.getElementById('btnSearch');
    if(searchBtn){ searchBtn.innerHTML=withIcon('search',''); }
    init();
});
    </script>


<deepl-input-controller translate="no"></deepl-input-controller></body></html>
