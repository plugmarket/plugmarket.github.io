<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plugin Store</title>
    <style>
        :root{
            --bg-primary:#ffffff;
            --bg-secondary:#ffffff;
            --bg-tertiary:#f9fafb;
            --text-primary:#333;
            --text-secondary:#666;
            --text-tertiary:#999;
            --border-color:#e5e7eb;
            --shadow:rgba(0,0,0,0.08);
            --shadow-hover:rgba(0,0,0,0.12);
            --card-bg:#ffffff;
            --input-bg:#ffffff;
            --tag-bg:#f3f4f6;
            --tag-hover:#e5e7eb;
            --review-bg:#f9fafb;
            --footer-bg:#6b7280;
        }
        body.dark-mode{
            --bg-primary:#1a1a1a;
            --bg-secondary:#2d2d2d;
            --bg-tertiary:#383838;
            --text-primary:#e5e5e5;
            --text-secondary:#b3b3b3;
            --text-tertiary:#808080;
            --border-color:#404040;
            --shadow:rgba(0,0,0,0.3);
            --shadow-hover:rgba(0,0,0,0.5);
            --card-bg:#2d2d2d;
            --input-bg:#383838;
            --tag-bg:#404040;
            --tag-hover:#4a4a4a;
            --review-bg:#383838;
            --footer-bg:#1f1f1f;
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:var(--bg-primary);min-height:100vh;padding:20px;padding-bottom:80px;transition:background 0.3s ease}
        .container{max-width:1400px;margin:0 auto}
        
        /* ê³µì§€ì‚¬í•­ ë°°ë„ˆ */
        .notice-banner{
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:white;
            padding:20px 30px;
            border-radius:15px;
            margin-bottom:20px;
            box-shadow:0 4px 15px rgba(102,126,234,0.3);
            animation:slideDown 0.5s ease;
        }
        @keyframes slideDown{
            from{opacity:0;transform:translateY(-20px)}
            to{opacity:1;transform:translateY(0)}
        }
        .notice-banner h3{font-size:1.3em;margin-bottom:10px;display:flex;align-items:center;gap:10px}
        .notice-banner p{font-size:1em;line-height:1.6;opacity:0.95}
        .notice-close{
            background:rgba(255,255,255,0.2);
            border:none;
            color:white;
            padding:5px 15px;
            border-radius:8px;
            cursor:pointer;
            font-size:0.9em;
            margin-top:10px;
        }
        .notice-close:hover{background:rgba(255,255,255,0.3)}
        .notice-badge{
            background:rgba(255,255,255,0.3);
            padding:3px 10px;
            border-radius:12px;
            font-size:0.75em;
            font-weight:bold;
        }
        
        header{background:var(--bg-secondary);padding:30px;border-radius:20px;box-shadow:0 2px 10px var(--shadow);margin-bottom:30px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px;border:1px solid var(--border-color);transition:all 0.3s ease}
        .header-left h1{color:#667eea;font-size:2.5em;margin-bottom:10px}
        .subtitle{color:var(--text-secondary);font-size:1.1em}
        .user-info{text-align:right}
        .user-name{font-size:1.2em;color:var(--text-primary);margin-bottom:5px}
        .user-id{color:var(--text-secondary);font-size:0.9em}
        .user-stats{display:flex;gap:8px;margin-top:6px;font-size:0.9em}
        .stat-item{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:4px 10px;border-radius:12px}
        .btn-logout{margin-top:10px;padding:8px 20px;background:#ef4444;color:white;border:none;border-radius:8px;cursor:pointer;font-size:0.9em}
        .btn-logout:hover{background:#dc2626}
        .theme-toggle{position:fixed;top:20px;right:20px;background:var(--card-bg);border:2px solid var(--border-color);padding:12px 16px;border-radius:50px;cursor:pointer;font-size:1.5em;box-shadow:0 4px 15px var(--shadow);z-index:1000;transition:all 0.3s ease}
        .theme-toggle:hover{transform:scale(1.1);box-shadow:0 6px 20px var(--shadow-hover)}
        .search-section{background:var(--card-bg);padding:20px;border-radius:15px;margin-bottom:20px;box-shadow:0 2px 10px var(--shadow);border:1px solid var(--border-color);transition:all 0.3s ease}
        .search-bar{display:flex;gap:10px;margin-bottom:15px}
        .search-input{flex:1;padding:15px;border:2px solid var(--border-color);border-radius:10px;font-size:1em;background:var(--input-bg);color:var(--text-primary);transition:all 0.3s ease}
        .search-input:focus{outline:none;border-color:#667eea}
        .btn-search{padding:15px 30px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:10px;cursor:pointer;font-size:1em;font-weight:bold}
        .category-tags{display:flex;gap:10px;flex-wrap:wrap}
        .category-tag{padding:8px 15px;background:var(--tag-bg);border:none;border-radius:20px;cursor:pointer;font-size:0.9em;color:var(--text-primary);transition:all 0.3s ease}
        .category-tag:hover{background:var(--tag-hover)}
        .category-tag.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
        .filters{display:flex;gap:15px;margin-bottom:30px;flex-wrap:wrap;align-items:center}
        .filter-btn{background:var(--card-bg);border:1px solid var(--border-color);padding:12px 25px;border-radius:25px;cursor:pointer;font-size:1em;box-shadow:0 2px 8px var(--shadow);color:var(--text-primary);transition:all 0.3s ease}
        .filter-btn:hover{transform:translateY(-2px);box-shadow:0 3px 10px var(--shadow-hover)}
        .filter-btn.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none}
        .sort-select{padding:12px 20px;border:1px solid var(--border-color);border-radius:25px;background:var(--card-bg);cursor:pointer;font-size:1em;box-shadow:0 2px 8px var(--shadow);color:var(--text-primary);transition:all 0.3s ease}
        .plugins-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:25px;margin-bottom:30px}
        .plugin-card{background:var(--card-bg);border-radius:15px;padding:25px;box-shadow:0 2px 10px var(--shadow);border:1px solid var(--border-color);transition:all 0.3s}
        .plugin-card:hover{transform:translateY(-3px);box-shadow:0 4px 15px var(--shadow-hover)}
        .plugin-card.new-plugin{
            border:2px solid #667eea;
            animation:pulse 2s ease-in-out infinite;
        }
        @keyframes pulse{
            0%,100%{box-shadow:0 2px 10px var(--shadow)}
            50%{box-shadow:0 4px 20px rgba(102,126,234,0.4)}
        }
        .new-badge{
            background:#10b981;
            color:white;
            padding:3px 10px;
            border-radius:12px;
            font-size:0.75em;
            font-weight:bold;
            margin-left:8px;
            animation:blink 1.5s ease-in-out infinite;
        }
        @keyframes blink{
            0%,100%{opacity:1}
            50%{opacity:0.5}
        }
        .plugin-title{font-size:1.5em;color:var(--text-primary);margin-bottom:5px}
        .plugin-badge{padding:5px 15px;border-radius:20px;font-size:0.85em;font-weight:bold;background:#10b981;color:white}
        .plugin-category{display:inline-block;padding:3px 10px;background:var(--tag-bg);border-radius:10px;font-size:0.8em;color:var(--text-secondary);margin-bottom:10px}
        .plugin-description{color:var(--text-secondary);margin-bottom:15px;line-height:1.6}
        .plugin-version{color:var(--text-tertiary);font-size:0.9em;margin-bottom:15px}
        .plugin-rating{display:flex;align-items:center;gap:5px;margin-bottom:10px}
        .stars{color:#fbbf24}
        .rating-count{color:var(--text-tertiary);font-size:0.9em}
        .plugin-downloads{color:var(--text-secondary);font-size:0.9em;margin-bottom:15px}
        .plugin-footer{display:flex;gap:10px}
        .btn{flex:1;padding:12px;border:none;border-radius:10px;cursor:pointer;font-size:1em;font-weight:bold;transition:all 0.3s}
        .btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
        .btn-primary:hover{transform:scale(1.05)}
        .btn-secondary{background:var(--tag-bg);color:#667eea}
        .btn-secondary:hover{background:var(--tag-hover)}
        .header-actions{display:flex;gap:10px;align-items:center}
        .chip-btn{background:#f5f5f5;border:1px solid var(--border-color);color:#111;padding:10px 16px;border-radius:14px;cursor:pointer;box-shadow:0 2px 8px var(--shadow);font-size:0.95em}
        .chip-btn:hover{background:#efefef}
        .menu-wrapper{position:relative}
        .menu-dropdown{position:absolute;right:0;top:42px;background:var(--card-bg);border:1px solid var(--border-color);border-radius:12px;box-shadow:0 8px 20px var(--shadow);padding:10px;min-width:200px;display:none;z-index:1000}
        .menu-dropdown.show{display:block}
        .menu-item{padding:8px 12px;border-radius:8px;color:var(--text-primary);cursor:pointer}
        .menu-item:hover{background:var(--tag-hover)}
        .menu-item.disabled{cursor:default;color:var(--text-secondary)}
        .menu-item.danger{color:#ef4444}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:center;align-items:center}
        .modal.active{display:flex}
        .modal-content{background:var(--card-bg);padding:40px;border-radius:20px;max-width:600px;width:90%;max-height:85vh;overflow-y:auto;box-shadow:0 4px 20px rgba(0,0,0,0.15);transition:all 0.3s ease}
        .modal-header{font-size:1.8em;margin-bottom:20px;color:var(--text-primary)}
        .modal-body{margin-bottom:20px;line-height:1.8;color:var(--text-secondary)}
        .modal-footer{display:flex;gap:10px}
        footer{position:fixed;bottom:0;left:0;width:100%;background:var(--footer-bg);color:white;padding:20px;text-align:center;box-shadow:0 -2px 10px rgba(0,0,0,0.1);transition:all 0.3s ease}
        @media(max-width:768px){.plugins-grid{grid-template-columns:1fr}header{flex-direction:column;text-align:center}.theme-toggle{top:10px;right:10px;padding:10px 14px}}
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="í…Œë§ˆ ì „í™˜"></button>
    
    <!-- ê³µì§€ì‚¬í•­ í‘œì‹œ ì˜ì—­ -->
    <div class="container" id="noticesContainer"></div>
    
    <div class="container">
        <header>
            <div class="header-left">
                <h1>ğŸ® Plugin Store</h1>
                <p class="subtitle">ë§ˆì¸í¬ë˜í”„íŠ¸ í”ŒëŸ¬ê·¸ì¸ ìŠ¤í† ì–´</p>
            </div>
            <div class="user-info" id="userInfo">
                <div class="user-top" style="display:flex;align-items:center;gap:12px;justify-content:flex-end">
                    <div class="header-actions">
                        <button id="btnLogin" class="chip-btn" onclick="startDiscordLogin()">ë¡œê·¸ì¸</button>
                        <div class="menu-wrapper">
                            <button id="btnMenu" class="chip-btn" onclick="toggleMenuDropdown()">â˜°</button>
                            <div id="menuDropdown" class="menu-dropdown">
                                <div class="menu-item" onclick="requestCharge()">ì¶©ì „ ìš”ì²­</div>
                                <div class="menu-item" onclick="showHistory()">ë‹¤ìš´ë¡œë“œ ë‚´ì—­</div>
                                <div class="menu-item" id="menuAdmin" style="display:none" onclick="openAdmin()">ê´€ë¦¬ íˆ´</div>
                                <div class="menu-item danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="user-name" id="userName"></p>
                        <p class="user-id" id="userIdDisplay"></p>
                    </div>
                </div>
                <div class="user-stats">
                    <span class="stat-item">ğŸ’° <span id="userBalance">0</span>ì›</span>
                    <span class="stat-item">ğŸ“¥ <span id="downloadCount">0</span>ê°œ</span>
                    <span class="stat-item">â­ <span id="avgRating">0.0</span></span>
                </div>
            </div>
        </header>
        
        <div class="search-section">
            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="ê²€ìƒ‰...">
                <button id="btnSearch" class="btn-search" onclick="searchPlugins()">ğŸ”</button>
            </div>
            <div class="category-tags">
                <button class="category-tag active" data-category="all">ì „ì²´</button>
                <button class="category-tag" data-category="ê²Œì„í”Œë ˆì´">ê²Œì„í”Œë ˆì´</button>
                <button class="category-tag" data-category="ì‹œìŠ¤í…œ">ì‹œìŠ¤í…œ</button>
                <button class="category-tag" data-category="ì»¤ìŠ¤í…€">ì»¤ìŠ¤í…€</button>
                <button class="category-tag" data-category="RPG">RPG</button>
                <button class="category-tag" data-category="ê²½ì œ">ê²½ì œ</button>
            </div>
        </div>
        
        <div class="filters">
            <button class="filter-btn active" data-filter="all">ì „ì²´</button>
            <button class="filter-btn" data-filter="free">ë¬´ë£Œ</button>
            <button class="filter-btn" data-filter="premium">í”„ë¦¬ë¯¸ì—„</button>
            <button class="filter-btn" data-filter="downloaded">ë‹¤ìš´ë¡œë“œí•¨</button>
            <select class="sort-select" id="sortSelect">
                <option value="popular">ì¸ê¸°ìˆœ</option>
                <option value="rating">í‰ì ìˆœ</option>
                <option value="downloads">ë‹¤ìš´ë¡œë“œìˆœ</option>
                <option value="newest">ìµœì‹ ìˆœ</option>
            </select>
        </div>
        
        <div class="plugins-grid" id="pluginsGrid"></div>
    </div>
    
    <footer>
        <p>ëŒ€í‘œ ê³ ê°€ì˜¨ | ì´ë©”ì¼: <a href="mailto:gogaon036@gmail.com" style="color:white">gogaon036@gmail.com</a></p>
    </footer>

    <!-- ëª¨ë‹¬ë“¤ì€ ê¸°ì¡´ ì½”ë“œ ìœ ì§€ -->
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
    // Firebase ì´ˆê¸°í™”ë¥¼ í•¨ìˆ˜ ë‚´ë¶€ë¡œ ì´ë™
    let database = null;
    
    function initFirebase(){
        const firebaseConfig = {
            apiKey: "AIzaSyB_FsD_GqnENdMGeuzH5Q8tICxn_fgu7OQ",
            authDomain: "plugmarketdb.firebaseapp.com",
            databaseURL: "https://plugmarketdb-default-rtdb.firebaseio.com",
            projectId: "plugmarketdb",
            storageBucket: "plugmarketdb.firebasestorage.app",
            messagingSenderId: "142551495005",
            appId: "1:142551495005:web:6b2b02b9ea53b4198138b4",
            measurementId: "G-3YMWZPCFWQ"
        };

        if(!firebase.apps.length){
            firebase.initializeApp(firebaseConfig);
        }
        database = firebase.database();
    }
    const ADMIN_DISCORD_ID = '787223885766328340';
    
    let plugins = {};
    let currentUser = null;
    let notices = {};
    let dismissedNotices = JSON.parse(localStorage.getItem('dismissedNotices') || '[]');
    let currentFilter = 'all';
    let currentCategory = 'all';
    let currentSort = 'popular';
    
    // ê³µì§€ì‚¬í•­ ë¡œë“œ ë° í‘œì‹œ
    function loadAndShowNotices(){
        const stored = localStorage.getItem('notices');
        if(stored) notices = JSON.parse(stored);
        
        const container = document.getElementById('noticesContainer');
        const noticeList = Object.values(notices).filter(n => !dismissedNotices.includes(n.id));
        
        if(noticeList.length === 0){
            container.innerHTML = '';
            return;
        }
        
        // ì¤‘ìš”ë„ ìˆœìœ¼ë¡œ ì •ë ¬ (ì¤‘ìš” ê³µì§€ê°€ ë¨¼ì €)
        noticeList.sort((a, b) => {
            if(a.importance === 'important' && b.importance !== 'important') return -1;
            if(a.importance !== 'important' && b.importance === 'important') return 1;
            return 0;
        });
        
        container.innerHTML = noticeList.map(n => {
            const badge = n.importance === 'important' ? '<span class="notice-badge">ğŸ”¥ ì¤‘ìš”</span>' : '';
            return `
                <div class="notice-banner" id="notice-${n.id}">
                    <h3>ğŸ“¢ ${n.title} ${badge}</h3>
                    <p>${n.content}</p>
                    <p style="font-size:0.85em;opacity:0.8;margin-top:10px">${n.date}</p>
                    <button class="notice-close" onclick="dismissNotice('${n.id}')">ë‹«ê¸°</button>
                </div>
            `;
        }).join('');
    }
    
    window.dismissNotice = function(noticeId){
        dismissedNotices.push(noticeId);
        localStorage.setItem('dismissedNotices', JSON.stringify(dismissedNotices));
        const el = document.getElementById(`notice-${noticeId}`);
        if(el) el.style.display = 'none';
    };
    
    // Firebaseì—ì„œ ê³µì§€ì‚¬í•­ ì‹¤ì‹œê°„ ë¡œë“œ
    function setupNoticesListener(){
        if(!database) return;
        try{
            database.ref('notices').on('value', (snapshot) => {
                const firebaseNotices = snapshot.val();
                if(firebaseNotices){
                    notices = firebaseNotices;
                    localStorage.setItem('notices', JSON.stringify(notices));
                    loadAndShowNotices();
                }
            });
        }catch(e){
            console.log('â„¹ï¸ Firebase ê³µì§€ì‚¬í•­ ë¡œë“œ ë¶ˆê°€');
        }
    }
    
    // Firebaseì—ì„œ í”ŒëŸ¬ê·¸ì¸ ì‹¤ì‹œê°„ ë¡œë“œ
    function setupPluginsListener(){
        if(!database) return;
        try{
            database.ref('plugins').on('value', (snapshot) => {
                const firebasePlugins = snapshot.val();
                if(firebasePlugins){
                    const oldPluginIds = Object.keys(plugins);
                    plugins = firebasePlugins;
                    localStorage.setItem('plugins', JSON.stringify(plugins));
                    
                    // ìƒˆ í”ŒëŸ¬ê·¸ì¸ ì²´í¬
                    const newPluginIds = Object.keys(plugins).filter(id => !oldPluginIds.includes(id));
                    if(newPluginIds.length > 0){
                        console.log('âœ… ìƒˆ í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€:', newPluginIds);
                        // ìƒˆ í”ŒëŸ¬ê·¸ì¸ í‘œì‹œë¥¼ ìœ„í•œ í”Œë˜ê·¸ ì„¤ì •
                        newPluginIds.forEach(id => {
                            if(plugins[id]) plugins[id]._isNew = true;
                        });
                    }
                    
                    renderPlugins();
                }
            });
        }catch(e){
            console.log('â„¹ï¸ Firebase í”ŒëŸ¬ê·¸ì¸ ë¡œë“œ ë¶ˆê°€');
        }
    }
    
    function renderPlugins(){
        const g = document.getElementById('pluginsGrid');
        if(!g) return;
        
        let l = Object.values(plugins);
        if(!l || l.length === 0) return;
        
        // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
        if(currentCategory !== 'all'){
            l = l.filter(p => p.category === currentCategory);
        }
        
        // íƒ€ì… í•„í„°ë§
        if(currentFilter === 'free'){
            l = l.filter(p => p.type === 'free');
        } else if(currentFilter === 'premium'){
            l = l.filter(p => p.type === 'paid' && (p.price || 0) > 0);
        } else if(currentFilter === 'downloaded' && currentUser){
            l = l.filter(p => currentUser.downloads && currentUser.downloads.some(d => d.pluginId === p.id));
        }
        
        // ê²€ìƒ‰ì–´ í•„í„°ë§
        const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
        if(searchTerm){
            l = l.filter(p => p.name.toLowerCase().includes(searchTerm) || p.description.toLowerCase().includes(searchTerm));
        }
        
        // ì •ë ¬
        if(currentSort === 'newest'){
            l.sort((a, b) => {
                const aTime = parseInt(a.id.substring(1)) || 0;
                const bTime = parseInt(b.id.substring(1)) || 0;
                return bTime - aTime;
            });
        } else if(currentSort === 'rating'){
            l.sort((a, b) => (b.rating || 0) - (a.rating || 0));
        } else if(currentSort === 'downloads'){
            l.sort((a, b) => (b.downloads || 0) - (a.downloads || 0));
        } else {
            // popular: ë‹¤ìš´ë¡œë“œ * í‰ì 
            l.sort((a, b) => {
                const aScore = (a.downloads || 0) * (a.rating || 0);
                const bScore = (b.downloads || 0) * (b.rating || 0);
                return bScore - aScore;
            });
        }
        
        g.innerHTML = l.map(p => {
            const isNew = p._isNew;
            const newBadge = isNew ? '<span class="new-badge">NEW!</span>' : '';
            const cardClass = isNew ? 'plugin-card new-plugin' : 'plugin-card';
            const isDownloaded = currentUser && currentUser.downloads && currentUser.downloads.some(d => d.pluginId === p.id);
            const isFree = p.type === 'free' || (p.price || 0) === 0;
            const badgeText = isFree ? 'ë¬´ë£Œ' : `${(p.price || 0).toLocaleString()}ì›`;
            const badgeColor = isFree ? '#10b981' : '#f59e0b';
            
            return `
                <div class="${cardClass}">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <h3 class="plugin-title">${p.name}${newBadge}</h3>
                        <span class="plugin-badge" style="background:${badgeColor}">${badgeText}</span>
                    </div>
                    <span class="plugin-category">${p.category}</span>
                    <p class="plugin-description">${p.description}</p>
                    <p class="plugin-version">v${p.version}</p>
                    <div class="plugin-rating">
                        <span class="stars">${'â˜…'.repeat(Math.round(p.rating || 0))}${'â˜†'.repeat(5 - Math.round(p.rating || 0))}</span>
                        <span class="rating-count">${(p.rating || 0).toFixed(1)}</span>
                    </div>
                    <p class="plugin-downloads">ğŸ“¥ ${p.downloads || 0}íšŒ</p>
                    ${isDownloaded ? '<div style="background:#10b981;color:white;padding:8px;border-radius:8px;text-align:center;margin:10px 0">âœ“ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ</div>' : ''}
                    <div class="plugin-footer">
                        <button class="btn btn-primary" onclick="showDetail('${p.id}')">ìƒì„¸ë³´ê¸°</button>
                    </div>
                </div>
            `;
        }).join('');
    }
    
    function setupListeners(){
        // ì¹´í…Œê³ ë¦¬ íƒœê·¸ í´ë¦­
        document.querySelectorAll('.category-tag').forEach(t => {
            t.addEventListener('click', function(){
                document.querySelectorAll('.category-tag').forEach(x => x.classList.remove('active'));
                this.classList.add('active');
                currentCategory = this.dataset.category;
                renderPlugins();
            });
        });
        
        // í•„í„° ë²„íŠ¼ í´ë¦­
        document.querySelectorAll('.filter-btn').forEach(b => {
            b.addEventListener('click', function(){
                document.querySelectorAll('.filter-btn').forEach(x => x.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.dataset.filter;
                renderPlugins();
            });
        });
        
        // ì •ë ¬ ì„ íƒ
        const sortSelect = document.getElementById('sortSelect');
        if(sortSelect){
            sortSelect.addEventListener('change', function(){
                currentSort = this.value;
                renderPlugins();
            });
        }
        
        // ê²€ìƒ‰ ì…ë ¥
        const searchInput = document.getElementById('searchInput');
        if(searchInput){
            searchInput.addEventListener('keypress', function(e){
                if(e.key === 'Enter') searchPlugins();
            });
        }
    }
    
    function searchPlugins(){
        renderPlugins();
    }
    
    function toggleMenuDropdown(){
        const dd = document.getElementById('menuDropdown');
        if(dd) dd.classList.toggle('show');
    }
    
    function openAdmin(){
        window.location.href = 'admin.html';
    }
    
    function requestCharge(){
        alert('ì¶©ì „ ê¸°ëŠ¥ì€ ë¡œê·¸ì¸ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    }
    
    function showHistory(){
        alert('ë‹¤ìš´ë¡œë“œ ë‚´ì—­ì€ ë¡œê·¸ì¸ í›„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    }
    
    function showDetail(pluginId){
        alert('í”ŒëŸ¬ê·¸ì¸ ìƒì„¸ ì •ë³´: ' + plugins[pluginId].name);
    }
    
    function startDiscordLogin(){
        alert('Discord ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„ í•„ìš”');
    }
    
    function logout(){
        if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
            currentUser = null;
            localStorage.removeItem('currentUser');
            location.reload();
        }
    }
    
    function toggleTheme(){
        const body = document.body;
        const isDark = body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }
    
    function loadTheme(){
        const savedTheme = localStorage.getItem('theme');
        if(savedTheme === 'dark') document.body.classList.add('dark-mode');
    }
    
    function init(){
        initFirebase(); // Firebase ë¨¼ì € ì´ˆê¸°í™”
        loadTheme();
        loadAndShowNotices();
        setupNoticesListener();
        setupPluginsListener();
        setupListeners(); // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        renderPlugins();
    }
    
    document.addEventListener('DOMContentLoaded', init);
    
    // ë‚˜ë¨¸ì§€ ê¸°ì¡´ í•¨ìˆ˜ë“¤ (showDetail, downloadPlugin ë“±) ìœ ì§€
    </script>
</body>
</html>
